<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ–∫–µ—Ä –ø–∏—Ç–∞–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #222222;
            --tg-theme-button-color: #4d6073;
            --tg-theme-button-text-color: #ffffff;
        }
        
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            background-color: var(--tg-theme-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #222222);
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow-y: auto;
        }

        .content-container {
            flex-grow: 1;
            padding-bottom: 70px; /* –î–ª—è –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
            overflow-y: auto;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #ffffff;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            color: #6c757d;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: #7a9b8e;
            font-weight: 600;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .section {
            display: none;
            padding: 20px;
        }

        .section.active {
            display: block;
        }

        .page-title {
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--tg-theme-text-color, #333);
        }

        .card {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 16px;
            border: none;
        }

        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            border-radius: 12px 12px 0 0 !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—É—Å—Ç—ã—Ö —Å–µ–∫—Ü–∏–π */
        .empty-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            color: #6c757d;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: #dee2e6;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #7a9b8e, #6b8b7d);
            border-color: #7a9b8e;
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(122, 155, 142, 0.3);
        }
        
        .btn-outline-primary {
            color: #7a9b8e;
            border-color: #7a9b8e;
        }
        
        .btn-outline-primary:hover {
            background: linear-gradient(135deg, #7a9b8e, #6b8b7d);
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(122, 155, 142, 0.3);
        }
        
        .badge.bg-primary {
            background: linear-gradient(135deg, #7a9b8e, #6b8b7d) !important;
        }

        /* –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Å–ø–∏–Ω–Ω–µ—Ä–æ–≤ */
        .text-primary {
            color: #7a9b8e !important;
        }
        
        .spinner-border.text-primary {
            border-color: #7a9b8e;
            border-right-color: transparent;
        }
        
        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
        }

        .error-message {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        #debug-info {
            padding: 10px;
            background-color: #f8f9fa;
            margin-bottom: 10px;
            font-size: 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Ç–æ–≥–æ–≤ –¥–Ω—è */
        .day-summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            margin-bottom: 20px;
        }

        .day-summary-card .card-header {
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .nutrition-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .nutrition-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .nutrition-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .meal-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--tg-theme-button-color, #4d6073);
        }

        .meal-time {
            font-weight: 600;
            color: var(--tg-theme-button-color, #4d6073);
            font-size: 0.9rem;
        }

        .meal-description {
            margin: 5px 0;
            color: #333;
        }

        .meal-calories {
            font-size: 0.9rem;
            color: #666;
        }

        .warning-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--tg-theme-button-color, #4d6073);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .progress-bar-custom {
            height: 8px;
            border-radius: 4px;
            background-color: #e9ecef;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--tg-theme-button-color, #4d6073), #667eea);
            transition: width 0.3s ease;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–ª—é–¥ */
        .meal-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .meal-image:hover {
            transform: scale(1.05);
        }

        .meal-image-placeholder {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            border: 2px solid #e9ecef;
            color: #6c757d;
            font-size: 24px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            cursor: pointer;
        }

        .image-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .image-modal img {
            max-width: 95vw;
            max-height: 95vh;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
            cursor: pointer;
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .image-modal img {
                max-width: 95vw;
                max-height: 85vh;
                min-width: 80vw;
                min-height: 60vh;
            }
            
            .image-modal-content {
                max-width: 95vw;
                max-height: 85vh;
            }
        }

        /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (iPhone SE –∏ –ø–æ–¥–æ–±–Ω—ã–µ) */
        @media (max-width: 480px) {
            .image-modal img {
                max-width: 98vw;
                max-height: 80vh;
                min-width: 85vw;
                min-height: 65vh;
            }
        }

        .image-modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: white;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            z-index: 2001;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .image-modal-close:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ –í–µ—Å */
        .weight-card {
            background: linear-gradient(135deg, #7a9b8e 0%, #5a7b6e 100%);
            color: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(122, 155, 142, 0.3);
        }

        .weight-current {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .weight-change {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .weight-change.positive {
            color: #ff6b6b;
        }

        .weight-change.negative {
            color: #51cf66;
        }

        .weight-goal {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 10px;
        }

        .period-selector {
            display: flex;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .period-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: 70px;
        }

        .period-btn.active {
            background: #7a9b8e;
            color: white;
            box-shadow: 0 2px 8px rgba(122, 155, 142, 0.3);
        }

        .weight-chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            height: 300px;
            position: relative;
        }

        .chart-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #6c757d;
            flex-direction: column;
        }

        .chart-placeholder i {
            font-size: 3rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .weight-history-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .weight-history-header {
            background: #f8f9fa;
            padding: 15px 20px;
            font-weight: 600;
            border-bottom: 1px solid #eee;
        }

        .weight-entry {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .weight-entry:last-child {
            border-bottom: none;
        }

        .weight-entry-date {
            font-weight: 500;
            color: #333;
        }

        .weight-entry-value {
            font-weight: 600;
            color: #7a9b8e;
        }

        .weight-entry-change {
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .weight-entry-change.positive {
            color: #ff6b6b;
        }

        .weight-entry-change.negative {
            color: #51cf66;
        }

        .weight-entry-delete {
            margin-left: 10px;
            background-color: #e9ecef; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω */
            border: none;
            cursor: pointer;
            width: 24px; /* –®–∏—Ä–∏–Ω–∞ –∫–Ω–æ–ø–∫–∏ */
            height: 24px; /* –í—ã—Å–æ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
            border-radius: 50%; /* –ö—Ä—É–≥–ª–∞—è —Ñ–æ—Ä–º–∞ */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0; /* –£–±—Ä–∞–ª–∏ –ø–∞–¥–¥–∏–Ω–≥, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∏–∫–æ–Ω–∫—É —á–µ—Ä–µ–∑ flex */
            transition: background-color 0.2s ease, opacity 0.2s ease;
            opacity: 0.8;
        }

        .weight-entry-delete:hover {
            background-color: #d8dfe3; /* –§–æ–Ω —Ç–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            opacity: 1;
        }

        .weight-entry-delete .fas.fa-times {
            font-size: 12px; /* –ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ */
            color: #495057; /* –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π —Ü–≤–µ—Ç –∏–∫–æ–Ω–∫–∏ */
            line-height: 1; /* –î–ª—è –ª—É—á—à–µ–≥–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∏–∫–æ–Ω–∫–∏ */
        }

         .add-weight-btn {
            background: #6c757d;
            border: none;
            border-radius: 12px;
            color: white;
            padding: 12px 20px;
            font-weight: 600;
            width: 100%;
            margin-bottom: 20px;
            transition: transform 0.2s ease;
        }
        .add-weight-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.3);
        }

        .weight-modal .modal-content {
            border-radius: 16px;
            border: none;
        }

        .weight-modal .modal-header {
            border-bottom: 1px solid #eee;
            padding: 20px;
        }

        .weight-modal .modal-body {
            padding: 20px;
        }

        .weight-input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .weight-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
            transition: border-color 0.2s ease;
        }

        .weight-input:focus {
            border-color: #7a9b8e;
            box-shadow: 0 0 0 0.2rem rgba(122, 155, 142, 0.25);
            outline: none;
        }

        .weight-unit {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div id="debug-info" style="display: none;">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <div id="imageModal" class="image-modal">
        <span class="image-modal-close">&times;</span>
        <div class="image-modal-content">
            <img id="modalImage" src="" alt="–£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–ª—é–¥–∞">
        </div>
    </div>
    
    <div class="content-container">
        <!-- –°–µ–∫—Ü–∏—è –î–Ω–µ–≤–Ω–∏–∫ -->
        <div id="diary-section" class="section active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="page-title" style="margin: 0;">üìò –î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</h2>
                <button id="shareDiaryBtn" class="btn btn-outline-primary btn-sm" onclick="shareDiary()" style="display: flex; align-items: center; gap: 8px;">
                    üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –¥–Ω–µ–≤–Ω–∏–∫–æ–º
                </button>
            </div>
            <div id="diary-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞...</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏) -->
        <div id="stats-section" class="section">
            <h2 class="page-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º -->
            <div class="date-navigator" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #7a9b8e 0%, #6b8b7d 100%); border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(122, 155, 142, 0.3);">
                <button onclick="navigateWeek(-1)" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                    ‚Äπ
                </button>
                <h3 id="weekRange" style="margin: 0; font-weight: 600; text-align: center;">–¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è</h3>
                <button id="nextWeekBtn" onclick="navigateWeek(1)" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                    ‚Ä∫
                </button>
            </div>
            
            <div id="stats-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
        <div id="recipes-section" class="section">
            <h2 class="page-title">üåü –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div id="recipes-content">
                <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
                <div class="card mb-3">
                    <div class="card-body" style="padding: 15px;">
                        <!-- –ü–æ–∏—Å–∫ -->
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text">üîç</span>
                                <input type="text" class="form-control" id="favorites-search" 
                                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º..." 
                                       oninput="filterFavorites()">
                            </div>
                        </div>
                        
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div class="mb-3">
                            <div class="d-flex flex-wrap gap-2" id="category-filters">
                                <button class="btn btn-sm btn-primary category-btn active" data-category="all" onclick="filterByCategory('all')">
                                    –í—Å–µ
                                </button>
                                <button class="btn btn-sm btn-outline-primary category-btn" data-category="breakfast" onclick="filterByCategory('breakfast')">
                                    üåÖ –ó–∞–≤—Ç—Ä–∞–∫–∏
                                </button>
                                <button class="btn btn-sm btn-outline-primary category-btn" data-category="lunch" onclick="filterByCategory('lunch')">
                                    üçΩÔ∏è –û–±–µ–¥—ã
                                </button>
                                <button class="btn btn-sm btn-outline-primary category-btn" data-category="dinner" onclick="filterByCategory('dinner')">
                                    üåô –£–∂–∏–Ω—ã
                                </button>
                                <button class="btn btn-sm btn-outline-primary category-btn" data-category="snack" onclick="filterByCategory('snack')">
                                    ü•® –ü–µ—Ä–µ–∫—É—Å—ã
                                </button>
                            </div>
                        </div>
                        
                        <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
                        <div class="d-flex align-items-center gap-2">
                            <span style="font-size: 0.9rem; color: #666;">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
                            <select class="form-select form-select-sm" id="sort-select" onchange="sortFavorites()" style="width: auto;">
                                <option value="date-desc">–ü–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ)</option>
                                <option value="date-asc">–ü–æ –¥–∞—Ç–µ (—Å—Ç–∞—Ä—ã–µ)</option>
                                <option value="calories-asc">–ü–æ –∫–∞–ª–æ—Ä–∏—è–º (–º–µ–Ω—å—à–µ)</option>
                                <option value="calories-desc">–ü–æ –∫–∞–ª–æ—Ä–∏—è–º (–±–æ–ª—å—à–µ)</option>
                                <option value="protein-desc">–ü–æ –±–µ–ª–∫–∞–º (–±–æ–ª—å—à–µ)</option>
                                <option value="name-asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥ -->
                <div id="favorites-list">
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –í–µ—Å -->
        <div id="weight-section" class="section">
            <h2 class="page-title">‚öñÔ∏è –í–µ—Å</h2>
            <div id="weight-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Å–µ...</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ü—Ä–æ—Ñ–∏–ª—å (–æ–±–Ω–æ–≤–ª–µ–Ω–∞) -->
        <div id="profile-section" class="section">
            <h2 class="page-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div id="profile-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <nav class="bottom-nav">
        <div class="container">
            <div class="row text-center">
                <div class="col">
                    <a href="#diary" class="nav-item active" data-section="diary-section">
                        <div class="nav-icon">üìò</div>
                        <span>–î–Ω–µ–≤–Ω–∏–∫</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#stats" class="nav-item" data-section="stats-section">
                        <div class="nav-icon">üìä</div>
                        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#recipes" class="nav-item" data-section="recipes-section">
                        <div class="nav-icon">üåü</div>
                        <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#weight" class="nav-item" data-section="weight-section">
                        <div class="nav-icon">‚öñÔ∏è</div>
                        <span>–í–µ—Å</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#profile" class="nav-item" data-section="profile-section">
                        <div class="nav-icon">üë§</div>
                        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ—Å–∞ -->
    <div class="modal fade weight-modal" id="addWeightModal" tabindex="-1" aria-labelledby="addWeightModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addWeightModalLabel">
                        <i class="fas fa-weight me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–µ—Å
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addWeightForm">
                        <div class="weight-input-group">
                            <input type="number" class="weight-input" id="weightInput" 
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å" step="0.1" min="30" max="250" required>
                            <span class="weight-unit">–∫–≥</span>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-secondary flex-fill" data-bs-dismiss="modal">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                            <button type="submit" class="btn btn-primary flex-fill" style="background: #7a9b8e; border-color: #7a9b8e;">
                                <i class="fas fa-save me-1"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        /**
         * –°–∏—Å—Ç–µ–º–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
         * –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
         */
        class DataCache {
            constructor() {
                this.cache = new Map();
                this.defaultTTL = {
                    diary: 5 * 60 * 1000,      // 5 –º–∏–Ω—É—Ç –¥–ª—è –¥–Ω–µ–≤–Ω–∏–∫–∞
                    stats: 10 * 60 * 1000,     // 10 –º–∏–Ω—É—Ç –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏  
                    profile: 30 * 60 * 1000,   // 30 –º–∏–Ω—É—Ç –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
                    daySummary: 3 * 60 * 1000  // 3 –º–∏–Ω—É—Ç—ã –¥–ª—è –∏—Ç–æ–≥–æ–≤ –¥–Ω—è
                };
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
                setInterval(() => this.cleanup(), 2 * 60 * 1000);
            }
            
            /**
             * –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
             */
            get(key) {
                const item = this.cache.get(key);
                if (!item) return null;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ TTL
                if (Date.now() > item.expiry) {
                    this.cache.delete(key);
                    return null;
                }
                
                return item.data;
            }
            
            /**
             * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à
             */
            set(key, data, customTTL = null) {
                const keyType = key.split('_')[0]; // diary, stats, profile, etc.
                const ttl = customTTL || this.defaultTTL[keyType] || 5 * 60 * 1000;
                
                this.cache.set(key, {
                    data: data,
                    timestamp: Date.now(),
                    expiry: Date.now() + ttl
                });
            }
            
            /**
             * –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
             */
            delete(key) {
                this.cache.delete(key);
            }
            
            /**
             * –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à
             */
            clear() {
                this.cache.clear();
            }
            
            /**
             * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
             */
            cleanup() {
                const now = Date.now();
                for (const [key, item] of this.cache.entries()) {
                    if (now > item.expiry) {
                        this.cache.delete(key);
                    }
                }
            }
            
            /**
             * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫—ç—à–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
             */
            getStats() {
                const stats = {
                    totalItems: this.cache.size,
                    items: []
                };
                
                for (const [key, item] of this.cache.entries()) {
                    stats.items.push({
                        key: key,
                        size: JSON.stringify(item.data).length,
                        age: Math.round((Date.now() - item.timestamp) / 1000),
                        ttl: Math.round((item.expiry - Date.now()) / 1000)
                    });
                }
                
                return stats;
            }
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫—ç—à–∞
        const dataCache = new DataCache();
        
        /**
         * –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ Chart.js
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
         */
        let chartJSLoaded = false;
        let chartJSLoading = false;
        
        async function loadChartJS() {
            // –ï—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
            if (chartJSLoaded || window.Chart) {
                chartJSLoaded = true;
                return true;
            }
            
            // –ï—Å–ª–∏ —É–∂–µ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞, –∂–¥–µ–º
            if (chartJSLoading) {
                return new Promise((resolve) => {
                    const checkLoaded = () => {
                        if (chartJSLoaded) {
                            resolve(true);
                        } else {
                            setTimeout(checkLoaded, 100);
                        }
                    };
                    checkLoaded();
                });
            }
            
            chartJSLoading = true;
            
            try {
                await new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                    script.onload = () => {
                        chartJSLoaded = true;
                        chartJSLoading = false;
                        resolve();
                    };
                    script.onerror = () => {
                        chartJSLoading = false;
                        reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Chart.js'));
                    };
                    document.head.appendChild(script);
                });
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Chart.js:', error);
                return false;
            }
        }
        
        /**
         * –ö–ª–∏–µ–Ω—Ç API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º Telegram –±–æ—Ç–∞
         */
        class TelegramBotApiClient {
            constructor(apiBaseUrl) {
                this.apiBaseUrl = apiBaseUrl || 'https://telegram-bot-api-h136.onrender.com/api';
                // –ü–æ–ª—É—á–∞–µ–º API –∫–ª—é—á –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                this.apiKey = 'test_api_key';
                
                // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ –¥–Ω—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @param {string} dateStr - –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –∏—Ç–æ–≥–æ–≤ –¥–Ω—è
             */
            async getDaySummary(userId, dateStr = null) {
                try {
                    // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –∫—ç—à–∞
                    const cacheKey = `daySummary_${userId}_${dateStr || 'today'}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                    const cachedData = dataCache.get(cacheKey);
                    if (cachedData) {
                        return cachedData;
                    }
                    
                    const url = dateStr ? 
                        `${this.apiBaseUrl}/day-summary/${userId}?date_str=${dateStr}` : 
                        `${this.apiBaseUrl}/day-summary/${userId}`;
                    // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                    const response = await this._fetchWithAuth(url);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
                    dataCache.set(cacheKey, response.data);
                    
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Ç–æ–≥–æ–≤ –¥–Ω—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @param {string} dateStr - –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è
             */
            async getDiary(userId, dateStr = null) {
                try {
                    // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –∫—ç—à–∞
                    const cacheKey = `diary_${userId}_${dateStr || 'today'}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                    const cachedData = dataCache.get(cacheKey);
                    if (cachedData) {
                        return cachedData;
                    }
                    
                    const url = dateStr ? 
                        `${this.apiBaseUrl}/diary-data/${userId}?date_str=${dateStr}` : 
                        `${this.apiBaseUrl}/diary-data/${userId}`;
                    // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                    const response = await this._fetchWithAuth(url);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
                    dataCache.set(cacheKey, response.data);
                    
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
             */
            async getStats(userId) {
                try {
                    // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –∫—ç—à–∞
                    const cacheKey = `stats_${userId}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                    const cachedData = dataCache.get(cacheKey);
                    if (cachedData) {
                        return cachedData;
                    }
                    
                    // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/stats/${userId}`);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
                    dataCache.set(cacheKey, response.data);
                    
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
                    * –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ–Ω—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} category - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –±–ª—é–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –º–µ–Ω—é
             */
            async getMenu(userId, category = null) {
                try {
                    const params = category ? `?category=${category}` : '';
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/menu/${userId}${params}`);
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ–Ω—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–ª—é–¥–µ
             * @param {number} dishId - ID –±–ª—é–¥–∞
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞
             */
            async getDishDetails(dishId) {
                try {
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/menu/dish/${dishId}`);
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–ª—é–¥–µ ${dishId}:`, error);
                    throw error;
                }
            }

            /**
             * –ü–æ–∏—Å–∫ –±–ª—é–¥ –≤ –º–µ–Ω—é
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} query - –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
             */
            async searchMenuDishes(userId, query) {
                try {
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/menu/search/${userId}?query=${encodeURIComponent(query)}`);
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –±–ª—é–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª—é–¥–∞ –∏–∑ –º–µ–Ω—é –≤ –¥–Ω–µ–≤–Ω–∏–∫
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {number} dishId - ID –±–ª—é–¥–∞
             * @param {string} mealType - –¢–∏–ø –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
             */
            async addDishToDiary(userId, dishId, mealType = 'lunch') {
                try {
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/menu/add-to-diary`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            user_id: userId,
                            dish_id: dishId,
                            meal_type: mealType
                        })
                    });
                    return response;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞ ${dishId} –≤ –¥–Ω–µ–≤–Ω–∏–∫:`, error);
                    throw error;
                }
            }

            /**
                    * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥
             */
            async getRecipes(userId) {
                try {
                    // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/recipes/${userId}`);
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è –¥–Ω–µ–≤–Ω–∏–∫–∞
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} period - –ü–µ—Ä–∏–æ–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ (week, month, custom)
             * @param {string} startDate - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ (–¥–ª—è custom)
             * @param {string} endDate - –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ (–¥–ª—è custom)
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ —Å –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–æ–π
             */
            async createDiaryShare(userId, period = 'week', startDate = null, endDate = null) {
                try {
                    const params = new URLSearchParams({
                        period,
                        ...(startDate && { start_date: startDate }),
                        ...(endDate && { end_date: endDate })
                    });
                    
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/diary/${userId}/share?${params}`, {
                        method: 'POST'
                    });
                    return response;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
             */
            async getUserProfile(userId) {
                try {
                    // –°–æ–∑–¥–∞–µ–º –∫–ª—é—á –¥–ª—è –∫—ç—à–∞
                    const cacheKey = `profile_${userId}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                    const cachedData = dataCache.get(cacheKey);
                    if (cachedData) {
                        return cachedData;
                    }
                    
                    // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/profile/${userId}`);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
                    dataCache.set(cacheKey, response.data);
                    
                    return response.data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è:', error);
                    throw error;
                }
            }

            /**
             * –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤–µ—Å–∞
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @param {string} timestamp - –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
             */
            async deleteWeightEntry(userId, timestamp) {
                try {
                    
                    // –í—ã–ø–æ–ª–Ω—è–µ–º DELETE –∑–∞–ø—Ä–æ—Å –∫ API
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/weight/${userId}?timestamp=${encodeURIComponent(timestamp)}`, {
                        method: 'DELETE'
                    });
                    
                    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –≤–µ—Å–∞ –∏ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
                    const cacheKeys = [
                        `weight_${userId}_week`,
                        `weight_${userId}_month`,
                        `weight_${userId}_6months`,
                        `weight_${userId}_year`,
                        `profile_${userId}`
                    ];
                    
                    cacheKeys.forEach(key => dataCache.delete(key));
                    
                    return {
                        success: true,
                        data: response.data
                    };
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –≤–µ—Å–∞:', error);
                    return {
                        success: false,
                        error: error.message
                    };
                }
            }

            /**
             * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @param {Object} profileData - –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
             */
            async updateUserProfile(userId, profileData) {
                try {
                    console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}`);
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/profile/${userId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(profileData)
                    });
                    
                    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    dataCache.delete(`profile_${userId}`);
                    // –¢–∞–∫–∂–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ø—Ä–æ—Ñ–∏–ª—è
                    dataCache.delete(`stats_${userId}`);
                    
                    return response;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
                    throw error;
                }
            }

            /**
             * –ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
             */
            async recalculateTargets(userId) {
                try {
                    console.log(`–ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}`);
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/profile/${userId}/recalculate`, {
                        method: 'POST'
                    });
                    return response;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:', error);
                    throw error;
                }
            }

            /**
             * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
             * @param {Object} mealData - –î–∞–Ω–Ω—ã–µ –æ –ø—Ä–∏–µ–º–µ –ø–∏—â–∏
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
             */
            async addMeal(mealData) {
                try {
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/meal`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(mealData)
                    });
                    return response;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏:', error);
                    throw error;
                }
            }

            /**
             * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
             * @param {string} url - URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
             * @param {Object} options - –û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
             * @private
             */
            async _fetchWithAuth(url, options = {}) {
                const headers = {
                    'X-API-Key': this.apiKey,
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0',
                    ...(options.headers || {})
                };

                // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞
                const separator = url.includes('?') ? '&' : '?';
                const urlWithTimestamp = `${url}${separator}_t=${Date.now()}`;

                // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log(`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫: ${urlWithTimestamp}`);
                console.log('–ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:', headers);
                console.log('API –∫–ª—é—á:', this.apiKey);
                console.log('–û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', options);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –ø–∞–Ω–µ–ª—å
                const debugInfo = document.getElementById('debug-info');
                if (debugInfo) {
                    debugInfo.innerHTML += `<br>–ó–∞–ø—Ä–æ—Å –∫: ${urlWithTimestamp}`;
                    debugInfo.innerHTML += `<br>API –∫–ª—é—á: ${this.apiKey}`;
                }

                try {
                    const response = await fetch(urlWithTimestamp, {
                        ...options,
                        headers
                    });

                    // –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç
                    console.log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);
                    console.log('–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', response.headers);
                    
                    if (debugInfo) {
                        debugInfo.innerHTML += `<br>–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`;
                    }

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`);
                        console.error('–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏:', errorText);
                        
                        if (debugInfo) {
                            debugInfo.innerHTML += `<br>–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`;
                            debugInfo.innerHTML += `<br>–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: ${errorText}`;
                        }
                        
                        throw new Error(`API –∑–∞–ø—Ä–æ—Å –Ω–µ —É–¥–∞–ª—Å—è: ${response.status} ${response.statusText} - ${errorText}`);
                    }

                    const data = await response.json();
                    console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', error);
                    
                    if (debugInfo) {
                        debugInfo.innerHTML += `<br>–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`;
                    }
                    
                    throw error;
                }
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @param {string} period - –ü–µ—Ä–∏–æ–¥ (week, month, 6months, year)
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –æ –≤–µ—Å–µ
             */
            async getWeightHistory(userId, period = 'month') {
                try {
                    const cacheKey = `weight_${userId}_${period}`;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
                    const cachedData = dataCache.get(cacheKey);
                    if (cachedData) {
                        return cachedData;
                    }
                    
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/weight/${userId}?period=${period}`);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç
                    dataCache.set(cacheKey, response.data, 5 * 60 * 1000);
                    
                    return response.data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏ –≤–µ—Å–∞:', error);
                    throw error;
                }
            }

            /**
             * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –≤–µ—Å–∞
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @param {Object} weightData - –î–∞–Ω–Ω—ã–µ –æ –≤–µ—Å–µ {weight, note}
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
             */
            async addWeightEntry(userId, weightData) {
                try {
                    console.log(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Å–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}`, weightData);
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ –ª–æ–≥–∏–∫—É —á—Ç–æ –∏ –≤ –±–æ—Ç–µ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –ö–ë–ñ–£
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/weight/${userId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            weight: weightData.weight,
                            note: weightData.note || '',
                            recalculate_targets: true  // –§–ª–∞–≥ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –∫–∞–∫ –≤ –±–æ—Ç–µ
                        })
                    });
                    
                    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –≤–µ—Å–∞ –∏ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                    const cacheKeys = [
                        `weight_${userId}_week`,
                        `weight_${userId}_month`,
                        `weight_${userId}_6months`,
                        `weight_${userId}_year`,
                        `profile_${userId}`,
                        `stats_${userId}`
                    ];
                    cacheKeys.forEach(key => dataCache.delete(key));
                    
                    return response;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤–µ—Å–∞:', error);
                    throw error;
                }
            }
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            updateDebugInfo();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API –∫–ª–∏–µ–Ω—Ç–∞
            const apiClient = new TelegramBotApiClient();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            initTelegramWebApp();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
            loadAllData();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.section');

            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    navItems.forEach(navItem => navItem.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                    this.classList.add('active');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å–µ–∫—Ü–∏–∏
                    const userId = getUserId();
                    if (sectionId === 'diary-section') {
                        loadDiaryData(userId);
                    } else if (sectionId === 'stats-section') {
                        loadStatsData(userId);
                    } else if (sectionId === 'recipes-section') {
                        loadRecipesData(userId);
                    } else if (sectionId === 'weight-section') {
                        loadWeightData(userId, currentWeightPeriod);
                    } else if (sectionId === 'profile-section') {
                        loadProfileData(userId);
                    }
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–≤–µ—Ä—Ö
                    window.scrollTo(0, 0);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏"
            document.addEventListener('click', function(e) {
                if (e.target.closest('#addMealBtn')) {
                    sendDataToBot({
                        action: 'add_meal',
                        timestamp: new Date().toISOString()
                    });
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" –≤ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥–∞—Ö
            document.addEventListener('click', function(e) {
                if (e.target.closest('.recipe-details-btn')) {
                    const recipeCard = e.target.closest('.card');
                    const recipeTitle = recipeCard.querySelector('.card-title').textContent;
                    
                    sendDataToBot({
                        action: 'get_recipe_details',
                        recipe: recipeTitle
                    });
                }
            });
        });

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∏—Ç–æ–≥–∞–º–∏ –¥–Ω—è
         */
        async function loadStatsData(userId) {
            // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            const statsContent = document.getElementById('stats-content');
            
            try {
                statsContent.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤...</p>
                    </div>
                `;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º Chart.js –ø–µ—Ä–µ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≥—Ä–∞—Ñ–∏–∫–æ–≤
                const chartLoaded = await loadChartJS();
                if (!chartLoaded) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –≥—Ä–∞—Ñ–∏–∫–æ–≤');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
                statsContent.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                    </div>
                `;
                
                // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                const apiClient = new TelegramBotApiClient();
                const statsData = await apiClient.getStats(userId);
                
                await renderStatsWithCharts(statsData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                statsContent.innerHTML = `
                    <div class="error-message">
                        <p><i class="fas fa-exclamation-circle"></i> –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="loadStatsData(getUserId())">
                            <i class="fas fa-sync-alt"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –∏—Ç–æ–≥–∞–º–∏ –¥–Ω—è
         */
        function renderStatsData(statsData) {
            // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            
            const statsContent = document.getElementById('stats-content');
            
            let todaySummaryHtml = '';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ç–æ–≥–∏ –¥–Ω—è, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (statsData.today_summary) {
                const summary = statsData.today_summary;
                
                todaySummaryHtml = `
                    <div class="card day-summary-card">
                        <div class="card-header">
                            <h5 class="mb-0">üçé –ò—Ç–æ–≥–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h5>
                        </div>
                        <div class="card-body">
                            ${summary.message ? `
                                <div class="text-center py-3">
                                    <p class="mb-0" style="color: #6c757d;">${summary.message}</p>
                                </div>
                            ` : `
                                <div class="nutrition-grid">
                                    <div class="nutrition-item">
                                        <div class="nutrition-value">${summary.total_calories}</div>
                                        <div class="nutrition-label">–ö–∞–ª–æ—Ä–∏–∏</div>
                                    </div>
                                    <div class="nutrition-item">
                                        <div class="nutrition-value">${summary.total_protein}</div>
                                        <div class="nutrition-label">–ë–µ–ª–∫–∏ (–≥)</div>
                                    </div>
                                    <div class="nutrition-item">
                                        <div class="nutrition-value">${summary.total_fat}</div>
                                        <div class="nutrition-label">–ñ–∏—Ä—ã (–≥)</div>
                                    </div>
                                    <div class="nutrition-item">
                                        <div class="nutrition-value">${summary.total_carb}</div>
                                        <div class="nutrition-label">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</div>
                                    </div>
                                </div>
                                
                                ${summary.meals && summary.meals.length > 0 ? `
                                    <h6 class="mb-3">–ü—Ä–∏–µ–º—ã –ø–∏—â–∏:</h6>
                                    ${summary.meals.map(meal => `
                                        <div class="meal-item">
                                            <div class="meal-time">${meal.time}</div>
                                            <div class="meal-description">${meal.description}</div>
                                            <div class="meal-calories">${meal.calories} –∫–∫–∞–ª</div>
                                        </div>
                                    `).join('')}
                                ` : ''}
                                
                                ${summary.remaining_calories > 0 || summary.remaining_protein > 0 || summary.remaining_fat > 0 || summary.remaining_carb > 0 ? `
                                    <h6 class="mb-3 mt-4">–û—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:</h6>
                                    <div class="nutrition-grid">
                                        <div class="nutrition-item">
                                            <div class="nutrition-value">${summary.remaining_calories}</div>
                                            <div class="nutrition-label">–ö–∞–ª–æ—Ä–∏–∏</div>
                                        </div>
                                        <div class="nutrition-item">
                                            <div class="nutrition-value">${summary.remaining_protein}</div>
                                            <div class="nutrition-label">–ë–µ–ª–∫–∏ (–≥)</div>
                                        </div>
                                        <div class="nutrition-item">
                                            <div class="nutrition-value">${summary.remaining_fat}</div>
                                            <div class="nutrition-label">–ñ–∏—Ä—ã (–≥)</div>
                                        </div>
                                        <div class="nutrition-item">
                                            <div class="nutrition-value">${summary.remaining_carb}</div>
                                            <div class="nutrition-label">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${summary.warnings && summary.warnings.length > 0 ? `
                                    <div class="mt-4">
                                        <h6 class="mb-3">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h6>
                                        ${summary.warnings.map(warning => `
                                            <div class="warning-item">${warning}</div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            `}
                        </div>
                    </div>
                `;
            }
            
            // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const general = statsData.general;
            const nutrition = statsData.nutrition_distribution;
            const targets = statsData.user_targets;
            
            statsContent.innerHTML = `
                ${todaySummaryHtml}
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                    </div>
                    <div class="card-body">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value">${general.avg_calories}</div>
                                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–∏ –≤ –¥–µ–Ω—å</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${general.days_tracked}</div>
                                <div class="stat-label">–î–Ω–µ–π –æ—Ç—Å–ª–µ–∂–µ–Ω–æ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${general.adherence_percent}%</div>
                                <div class="stat-label">–°–æ–±–ª—é–¥–µ–Ω–∏–µ –Ω–æ—Ä–º—ã</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${general.weight_change > 0 ? '+' : ''}${general.weight_change}</div>
                                <div class="stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Å–∞ (–∫–≥)</div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h6 class="mb-3">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–∞–ª–æ—Ä–∏—è–º</h6>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: ${Math.min(100, (general.avg_calories / targets.calories) * 100)}%"></div>
                            </div>
                            <div class="d-flex justify-content-between mt-2">
                                <small class="text-muted">${general.avg_calories} –∫–∫–∞–ª</small>
                                <small class="text-muted">–¶–µ–ª—å: ${targets.calories} –∫–∫–∞–ª</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">ü•ó –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ë–ñ–£</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>–ë–µ–ª–∫–∏</span>
                                <span>${nutrition.protein}%</span>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: ${nutrition.protein}%; background: #7a9b8e;"></div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>–ñ–∏—Ä—ã</span>
                                <span>${nutrition.fat}%</span>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: ${nutrition.fat}%; background: #ffc107;"></div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>–£–≥–ª–µ–≤–æ–¥—ã</span>
                                <span>${nutrition.carb}%</span>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill" style="width: ${nutrition.carb}%; background: #17a2b8;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${statsData.top_products && statsData.top_products.length > 0 ? `
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">üèÜ –¢–æ–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h5>
                        </div>
                        <div class="card-body">
                            ${statsData.top_products.map((product, index) => `
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>${index + 1}. ${product.name}</span>
                                    <span class="badge bg-primary">${product.count}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üéØ –¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6 mb-2">
                                <small class="text-muted">–ö–∞–ª–æ—Ä–∏–∏:</small>
                                <div class="fw-bold">${targets.calories} –∫–∫–∞–ª</div>
                            </div>
                            <div class="col-6 mb-2">
                                <small class="text-muted">–ë–µ–ª–∫–∏:</small>
                                <div class="fw-bold">${targets.protein} –≥</div>
                            </div>
                            <div class="col-6 mb-2">
                                <small class="text-muted">–ñ–∏—Ä—ã:</small>
                                <div class="fw-bold">${targets.fat} –≥</div>
                            </div>
                            <div class="col-6 mb-2">
                                <small class="text-muted">–£–≥–ª–µ–≤–æ–¥—ã:</small>
                                <div class="fw-bold">${targets.carb} –≥</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
         */
        async function loadProfileData(userId) {
            const profileContent = document.getElementById('profile-content');
            
            try {
                profileContent.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è...</p>
                    </div>
                `;
                
                const apiClient = new TelegramBotApiClient();
                const profileData = await apiClient.getUserProfile(userId);
                
                renderProfileData(profileData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ—Ñ–∏–ª—è:', error);
                profileContent.innerHTML = `
                    <div class="error-message">
                        <p><i class="fas fa-exclamation-circle"></i> –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="loadProfileData('${userId}')">
                            <i class="fas fa-sync-alt"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
         */
        function renderProfileData(profileData) {
            const profileContent = document.getElementById('profile-content');
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
            const targetKcal = profileData.target_kcal || 0;
            const targetProtein = profileData.target_protein || 0;
            const targetFat = profileData.target_fat || 0;
            const targetCarb = profileData.target_carb || 0;
            const targetFiber = profileData.target_fiber || 0;
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ
            let activityText = "–ù–µ —É–∫–∞–∑–∞–Ω–æ";
            switch(profileData.activity) {
                case "–Ω–∏–∑–∫–∏–π":
                    activityText = "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è";
                    break;
                case "—Å—Ä–µ–¥–Ω–∏–π":
                    activityText = "–°—Ä–µ–¥–Ω—è—è";
                    break;
                case "–≤—ã—Å–æ–∫–∏–π":
                    activityText = "–í—ã—Å–æ–∫–∞—è";
                    break;
            }
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ
            const genderText = profileData.gender === "–º—É–∂" ? "–ú—É–∂—Å–∫–æ–π" : 
                               profileData.gender === "–∂–µ–Ω" ? "–ñ–µ–Ω—Å–∫–∏–π" : "–ù–µ —É–∫–∞–∑–∞–Ω–æ";
            
            profileContent.innerHTML = `
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
                        <button class="btn btn-sm btn-outline-primary edit-profile-btn" data-section="personal">
                            <i class="fas fa-pencil-alt"></i> –ò–∑–º–µ–Ω–∏—Ç—å
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ü–æ–ª:</div>
                            <div class="col-6">${genderText}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–í–æ–∑—Ä–∞—Å—Ç:</div>
                            <div class="col-6">${profileData.age || "–ù–µ —É–∫–∞–∑–∞–Ω–æ"} –ª–µ—Ç</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–†–æ—Å—Ç:</div>
                            <div class="col-6">${profileData.height || "–ù–µ —É–∫–∞–∑–∞–Ω–æ"} —Å–º</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–¢–µ–∫—É—â–∏–π –≤–µ—Å:</div>
                            <div class="col-6">${profileData.weight || "–ù–µ —É–∫–∞–∑–∞–Ω–æ"} –∫–≥</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ñ–µ–ª–∞–µ–º—ã–π –≤–µ—Å:</div>
                            <div class="col-6">${profileData.goal || "–ù–µ —É–∫–∞–∑–∞–Ω–æ"} –∫–≥</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</div>
                            <div class="col-6">${activityText}</div>
                        </div>
                        ${profileData.gender === "–∂–µ–Ω" ? `
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å/–ì–í:</div>
                            <div class="col-6">${profileData.pregnant ? "–î–∞" : "–ù–µ—Ç"}</div>
                        </div>` : ''}
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <span>–¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</span>
                    </div>
                    <div class="card-body">
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ö–∞–ª–æ—Ä–∏–∏:</div>
                            <div class="col-6">${targetKcal} –∫–∫–∞–ª</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ë–µ–ª–∫–∏:</div>
                            <div class="col-6">${targetProtein} –≥</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ñ–∏—Ä—ã:</div>
                            <div class="col-6">${targetFat} –≥</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–£–≥–ª–µ–≤–æ–¥—ã:</div>
                            <div class="col-6">${targetCarb} –≥</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ö–ª–µ—Ç—á–∞—Ç–∫–∞:</div>
                            <div class="col-6">${targetFiber} –≥</div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                –¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                            </small>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                        <button class="btn btn-sm btn-outline-primary edit-profile-btn" data-section="settings">
                            <i class="fas fa-cog"></i> –ò–∑–º–µ–Ω–∏—Ç—å
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:</div>
                            <div class="col-6">UTC ${profileData.utc_offset >= 0 ? '+' : ''}${profileData.utc_offset}</div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6 text-muted">–£—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:</div>
                            <div class="col-6">${profileData.morning_reminders_enabled !== undefined ? (profileData.morning_reminders_enabled ? "–í–∫–ª—é—á–µ–Ω—ã" : "–í—ã–∫–ª—é—á–µ–Ω—ã") : "–í–∫–ª—é—á–µ–Ω—ã"}</div>
                        </div>
                    </div>
                </div>
                
                <button id="logoutBtn" class="btn btn-outline-danger w-100 mb-4">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                </button>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.querySelectorAll('.edit-profile-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    showEditProfileForm(section, profileData);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π - –£–î–ê–õ–ï–ù
            // –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å" —É–±—Ä–∞–Ω–∞, –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
            document.getElementById('logoutBtn').addEventListener('click', function() {
                // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                localStorage.removeItem('telegramUser');
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.close();
                } else {
                    alert('–§—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Telegram');
                }
            });
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
         */
        function showEditProfileForm(section, profileData) {
            const profileContent = document.getElementById('profile-content');
            
            if (section === 'personal') {
                profileContent.innerHTML = `
                    <div class="card mb-4">
                        <div class="card-header">
                            <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</span>
                        </div>
                        <div class="card-body">
                            <form id="personalDataForm">
                                <div class="mb-3">
                                    <label for="gender" class="form-label">–ü–æ–ª</label>
                                    <select class="form-select" id="gender" required>
                                        <option value="–º—É–∂" ${profileData.gender === "–º—É–∂" ? "selected" : ""}>–ú—É–∂—Å–∫–æ–π</option>
                                        <option value="–∂–µ–Ω" ${profileData.gender === "–∂–µ–Ω" ? "selected" : ""}>–ñ–µ–Ω—Å–∫–∏–π</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="age" class="form-label">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç)</label>
                                    <input type="number" class="form-control" id="age" value="${profileData.age || ""}" min="12" max="100" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="height" class="form-label">–†–æ—Å—Ç (—Å–º)</label>
                                    <input type="number" class="form-control" id="height" value="${profileData.height || ""}" min="100" max="250" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="weight" class="form-label">–¢–µ–∫—É—â–∏–π –≤–µ—Å (–∫–≥)</label>
                                    <input type="number" class="form-control" id="weight" value="${profileData.weight || ""}" min="30" max="250" step="0.1" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="goal" class="form-label">–ñ–µ–ª–∞–µ–º—ã–π –≤–µ—Å (–∫–≥)</label>
                                    <input type="number" class="form-control" id="goal" value="${profileData.goal || ""}" min="30" max="250" step="0.1" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="activity" class="form-label">–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label>
                                    <select class="form-select" id="activity" required>
                                        <option value="–Ω–∏–∑–∫–∏–π" ${profileData.activity === "–Ω–∏–∑–∫–∏–π" ? "selected" : ""}>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è</option>
                                        <option value="—Å—Ä–µ–¥–Ω–∏–π" ${profileData.activity === "—Å—Ä–µ–¥–Ω–∏–π" ? "selected" : ""}>–°—Ä–µ–¥–Ω—è—è</option>
                                        <option value="–≤—ã—Å–æ–∫–∏–π" ${profileData.activity === "–≤—ã—Å–æ–∫–∏–π" ? "selected" : ""}>–í—ã—Å–æ–∫–∞—è</option>
                                    </select>
                                    <div class="form-text">
                                        <small>
                                            <strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è</strong> ‚Äî —Å–∏–¥—è—á–∞—è —Ä–∞–±–æ—Ç–∞, –ø–æ—á—Ç–∏ –Ω–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è, –Ω–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.<br>
                                            <strong>–°—Ä–µ–¥–Ω—è—è</strong> ‚Äî –Ω–µ–º–Ω–æ–≥–æ –¥–≤–∏–≥–∞–µ—à—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è, –±—ã–≤–∞—é—Ç –ª—ë–≥–∫–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 1‚Äì2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é.<br>
                                            <strong>–í—ã—Å–æ–∫–∞—è</strong> ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ –∏–ª–∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 3‚Äì5 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.
                                        </small>
                                    </div>
                                </div>
                                
                                ${profileData.gender === "–∂–µ–Ω" ? `
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="pregnant" ${profileData.pregnant ? "checked" : ""}>
                                    <label class="form-check-label" for="pregnant">–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ –≥—Ä—É–¥–Ω–æ–µ –≤—Å–∫–∞—Ä–º–ª–∏–≤–∞–Ω–∏–µ</label>
                                </div>` : ''}
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary cancel-edit-btn">–û—Ç–º–µ–Ω–∞</button>
                                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            } else if (section === 'settings') {
                profileContent.innerHTML = `
                    <div class="card mb-4">
                        <div class="card-header">
                            <span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫</span>
                        </div>
                        <div class="card-body">
                            <form id="settingsForm">
                                <div class="mb-3">
                                    <label for="timezone" class="form-label">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (UTC)</label>
                                    <select class="form-select" id="timezone" required>
                                        ${generateTimezoneOptions(profileData.utc_offset)}
                                    </select>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="morningReminders" ${profileData.morning_reminders_enabled !== undefined ? (profileData.morning_reminders_enabled ? "checked" : "") : "checked"}>
                                    <label class="form-check-label" for="morningReminders">–£—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                                    <div class="form-text">–ë–æ—Ç –±—É–¥–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∞—Ç—å –∑–∞–≤—Ç—Ä–∞–∫</div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary cancel-edit-btn">–û—Ç–º–µ–Ω–∞</button>
                                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã
            document.querySelector('.cancel-edit-btn').addEventListener('click', function() {
                const userId = getUserId();
                loadProfileData(userId);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ–æ—Ä–º—ã –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            if (section === 'personal') {
                document.getElementById('personalDataForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const userId = getUserId();
                    const updatedData = {
                        gender: document.getElementById('gender').value,
                        age: parseInt(document.getElementById('age').value),
                        height: parseInt(document.getElementById('height').value),
                        weight: parseFloat(document.getElementById('weight').value),
                        goal: parseFloat(document.getElementById('goal').value),
                        activity: document.getElementById('activity').value
                    };
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∂–µ–Ω—â–∏–Ω
                    if (updatedData.gender === "–∂–µ–Ω") {
                        updatedData.pregnant = document.getElementById('pregnant').checked;
                    }
                    
                    updateProfile(userId, updatedData);
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ñ–æ—Ä–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
            if (section === 'settings') {
                document.getElementById('settingsForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const userId = getUserId();
                    const updatedData = {
                        utc_offset: parseInt(document.getElementById('timezone').value),
                        morning_reminders_enabled: document.getElementById('morningReminders').checked
                    };
                    
                    updateProfile(userId, updatedData);
                });
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
         */
        async function updateProfile(userId, updatedData) {
            const profileContent = document.getElementById('profile-content');
            
            try {
                profileContent.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π...</p>
                    </div>
                `;
                
                const apiClient = new TelegramBotApiClient();
                const updateResponse = await apiClient.updateUserProfile(userId, updatedData);
                
                // –û—á–∏—â–∞–µ–º –≤–µ—Å—å –∫—ç—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
                const cacheKeys = [
                    `profile_${userId}`,
                    `stats_${userId}`,
                    `diary_${userId}`,
                    `day_summary_${userId}`
                ];
                
                cacheKeys.forEach(key => {
                    dataCache.delete(key);
                });
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –∫—ç—à —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
                for (let i = -30; i <= 30; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() + i);
                    const dateStr = date.toISOString().split('T')[0];
                    dataCache.delete(`day_summary_${userId}_${dateStr}`);
                    dataCache.delete(`diary_data_${userId}_${dateStr}`);
                }
                
                console.log('–ö—ç—à –æ—á–∏—â–µ–Ω –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
                const updatedProfileData = await apiClient.getUserProfile(userId);
                renderProfileData(updatedProfileData);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                let message = '–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã';
                if (updateResponse.recalculated) {
                    message += ' –∏ —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã';
                }
                showToast(message);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥—Ä—É–≥–∏–µ —Ä–∞–∑–¥–µ–ª—ã –µ—Å–ª–∏ –æ–Ω–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                setTimeout(() => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –µ—Å–ª–∏ –æ–Ω–∞ –≤–∏–¥–Ω–∞
                    const statsSection = document.getElementById('stats-section');
                    if (statsSection && !statsSection.classList.contains('active') === false) {
                        loadStatsData(userId);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–Ω–µ–≤–Ω–∏–∫ –µ—Å–ª–∏ –æ–Ω –≤–∏–¥–µ–Ω
                    const diarySection = document.getElementById('diary-section');
                    if (diarySection && diarySection.classList.contains('active')) {
                        loadDiaryData(userId);
                    }
                }, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
                profileContent.innerHTML = `
                    <div class="error-message">
                        <p><i class="fas fa-exclamation-circle"></i> –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="loadProfileData('${userId}')">
                            <i class="fas fa-sync-alt"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Ñ–∏–ª—é
                        </button>
                    </div>
                `;
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
         */
        async function recalculateTargets(profileData) {
            const userId = getUserId();
            const profileContent = document.getElementById('profile-content');
            
            try {
                profileContent.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ü–µ—Ä–µ—Å—á–µ—Ç —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π...</p>
                    </div>
                `;
                
                const apiClient = new TelegramBotApiClient();
                await apiClient.recalculateTargets(userId);
                
                // –ï—Å–ª–∏ –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ, –∑–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                const updatedProfileData = await apiClient.getUserProfile(userId);
                renderProfileData(updatedProfileData);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–µ—Ä–µ—Å—á–µ—Ç–µ
                showToast('–¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:', error);
                profileContent.innerHTML = `
                    <div class="error-message">
                        <p><i class="fas fa-exclamation-circle"></i> –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
                        <button class="btn btn-outline-primary btn-sm mt-2" onclick="loadProfileData('${userId}')">
                            <i class="fas fa-sync-alt"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Ñ–∏–ª—é
                        </button>
                    </div>
                `;
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø—Ü–∏–π —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
         */
        function generateTimezoneOptions(currentOffset) {
            let options = '';
            for (let i = -12; i <= 14; i++) {
                options += `<option value="${i}" ${i === currentOffset ? 'selected' : ''}>UTC ${i >= 0 ? '+' : ''}${i}</option>`;
            }
            return options;
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
         */
        function showToast(message) {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const toastContainer = document.createElement('div');
            toastContainer.style.position = 'fixed';
            toastContainer.style.bottom = '20px';
            toastContainer.style.left = '50%';
            toastContainer.style.transform = 'translateX(-50%)';
            toastContainer.style.zIndex = '9999';
            
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.style.minWidth = '250px';
            toast.innerHTML = `
                <div class="toast-header">
                    <strong class="me-auto">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            toastContainer.appendChild(toast);
            document.body.appendChild(toastContainer);
            
            // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                document.body.removeChild(toastContainer);
            }, 3000);
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
         */
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            debugInfo.innerHTML = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const urlParams = new URLSearchParams(window.location.search);
            const userIdFromUrl = urlParams.get('userId');
            if (userIdFromUrl) {
                debugInfo.innerHTML += `<br>userId –∏–∑ URL: ${userIdFromUrl}`;
            } else {
                debugInfo.innerHTML += '<br>userId –≤ URL –Ω–µ –Ω–∞–π–¥–µ–Ω';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                debugInfo.innerHTML += '<br>Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω';
                if (window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                    const user = window.Telegram.WebApp.initDataUnsafe.user;
                    debugInfo.innerHTML += `<br>Telegram user: ${user.id} (${user.first_name})`;
                } else {
                    debugInfo.innerHTML += '<br>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                }
            } else {
                debugInfo.innerHTML += '<br>Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const savedUser = localStorage.getItem('telegramUser');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    debugInfo.innerHTML += `<br>localStorage user: ${userData.id}`;
                } catch (e) {
                    debugInfo.innerHTML += '<br>–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ localStorage';
                }
            } else {
                debugInfo.innerHTML += '<br>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
            }
            
            // –ò—Ç–æ–≥–æ–≤—ã–π userId
            const userId = getUserId();
            debugInfo.innerHTML += `<br>–ò—Ç–æ–≥–æ–≤—ã–π userId: ${userId || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}`;
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
         */
        async function loadAllData() {
            const userId = getUserId();
            
            if (!userId) {
                const errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.';
                showError('diary-content', errorMessage);
                showError('stats-content', errorMessage);
                showError('recipes-content', errorMessage);
                showError('profile-content', errorMessage);
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
            await Promise.all([
                loadDiaryData(userId),
                loadStatsData(userId),
                loadRecipesData(userId),
                loadProfileData(userId)
            ]);
        }

        /**
         * –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp
         */
        function getUserId() {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                console.log('–ü–æ–ª—É—á–µ–Ω userId –∏–∑ Telegram WebApp:', window.Telegram.WebApp.initDataUnsafe.user.id);
                return window.Telegram.WebApp.initDataUnsafe.user.id.toString();
            }
            
            // –ó–∞—Ç–µ–º –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const urlParams = new URLSearchParams(window.location.search);
            const userIdFromUrl = urlParams.get('userId');
            if (userIdFromUrl) {
                console.log('–ü–æ–ª—É—á–µ–Ω userId –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:', userIdFromUrl);
                return userIdFromUrl;
            }
            
            // –ó–∞—Ç–µ–º –ø—Ä–æ–±—É–µ–º –∏–∑ localStorage
            const savedUser = localStorage.getItem('telegramUser');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    if (userData && userData.id) {
                        console.log('–ü–æ–ª—É—á–µ–Ω userId –∏–∑ localStorage:', userData.id);
                        return userData.id.toString();
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage:', e);
                }
            }
            
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å userId. WebApp –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏–∑ Telegram.');
            return null;
        }

        /**
         * –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp
         */
        function initTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // –†–∞—Å—à–∏—Ä—è–µ–º WebApp –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                tg.expand();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    localStorage.setItem('telegramUser', JSON.stringify(tg.initDataUnsafe.user));
                    console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', tg.initDataUnsafe.user);
                }
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–µ–º—É
                document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#ffffff');
                document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#222222');
                document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#4d6073');
                document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
                
                console.log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } else {
                console.warn('Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.');
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É —á–µ—Ä–µ–∑ Telegram WebApp
         */
        function sendDataToBot(data) {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify(data));
                console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É:', data);
            } else {
                console.warn('Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω. –î–∞–Ω–Ω—ã–µ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É.');
                alert('–§—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Telegram');
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
         */
        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `
                    <div class="error-message">
                        <p><i class="fas fa-exclamation-circle"></i> ${message}</p>
                    </div>
                `;
            }
        }

        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –¥–Ω—è–º –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ
        let currentDayOffset = 0;

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–Ω–µ–≤–Ω–∏–∫
         */
        async function shareDiary() {
            try {
                const userId = getUserId();
                const shareDiaryBtn = document.getElementById('shareDiaryBtn');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const originalText = shareDiaryBtn.innerHTML;
                shareDiaryBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status"></span> –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏...';
                shareDiaryBtn.disabled = true;
                
                // –°–æ–∑–¥–∞–µ–º API –∫–ª–∏–µ–Ω—Ç –∏ –ø–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É
                const apiClient = new TelegramBotApiClient();
                const result = await apiClient.createDiaryShare(userId, 'week');
                
                if (result.success && result.share_url) {
                    // –ü—Ä–æ–±—É–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
                    let copySuccess = false;
                    
                    try {
                        // –°–ø–æ—Å–æ–± 1: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Clipboard API
                        if (navigator.clipboard && window.isSecureContext) {
                            await navigator.clipboard.writeText(result.share_url);
                            copySuccess = true;
                        }
                    } catch (e) {
                        console.log('Clipboard API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e);
                    }
                    
                    if (!copySuccess) {
                        try {
                            // –°–ø–æ—Å–æ–± 2: –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π input —ç–ª–µ–º–µ–Ω—Ç
                            const textArea = document.createElement('textarea');
                            textArea.value = result.share_url;
                            textArea.style.position = 'fixed';
                            textArea.style.left = '-999999px';
                            textArea.style.top = '-999999px';
                            document.body.appendChild(textArea);
                            textArea.focus();
                            textArea.select();
                            
                            // –ü—ã—Ç–∞–µ–º—Å—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ execCommand
                            copySuccess = document.execCommand('copy');
                            document.body.removeChild(textArea);
                        } catch (e) {
                            console.log('execCommand –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e);
                        }
                    }
                    
                    if (copySuccess) {
                        // –ï—Å–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–æ—Å—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        shareDiaryBtn.innerHTML = '‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!';
                        alert(`‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à –¥–Ω–µ–≤–Ω–∏–∫ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!\n\nüìã –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Å—ã–ª–∫–æ–π —Å –¥–∏–µ—Ç–æ–ª–æ–≥–æ–º\n\n‚è∞ –°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π`);
                    } else {
                        // –ï—Å–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                        const shareUrl = result.share_url;
                        
                        const modal = document.createElement('div');
                        modal.style.cssText = `
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0,0,0,0.5);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 10000;
                            padding: 20px;
                            box-sizing: border-box;
                        `;
                        
                        modal.innerHTML = `
                            <div style="
                                background: white;
                                border-radius: 12px;
                                padding: 24px;
                                max-width: 400px;
                                width: 100%;
                                text-align: center;
                                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                            ">
                                <h3 style="margin: 0 0 16px 0; color: #333;">‚úÖ –°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!</h3>
                                <p style="margin: 0 0 16px 0; color: #666; font-size: 14px;">
                                    –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–∏–µ—Ç–æ–ª–æ–≥—É –≤ —á–∞—Ç–µ:
                                </p>
                                <div id="shareUrlBox" style="
                                    background: #f8f9fa;
                                    border: 1px solid #dee2e6;
                                    border-radius: 8px;
                                    padding: 12px;
                                    margin: 16px 0;
                                    word-break: break-all;
                                    font-size: 12px;
                                    color: #495057;
                                    cursor: pointer;
                                    transition: all 0.2s ease;
                                    user-select: all;
                                    -webkit-user-select: all;
                                " onclick="copyShareUrl(this, '${shareUrl}')" 
                                   onmouseover="this.style.background='#e9ecef'; this.style.borderColor='#adb5bd';"
                                   onmouseout="this.style.background='#f8f9fa'; this.style.borderColor='#dee2e6';"
                                >${shareUrl}</div>
                                <p id="copyStatus" style="margin: 16px 0; color: #6c757d; font-size: 12px;">
                                    &nbsp;
                                </p>
                                <button onclick="this.parentElement.parentElement.remove()" style="
                                    background: #007bff;
                                    color: white;
                                    border: none;
                                    border-radius: 6px;
                                    padding: 10px 20px;
                                    font-size: 14px;
                                    cursor: pointer;
                                ">–ó–∞–∫—Ä—ã—Ç—å</button>
                            </div>
                        `;
                        
                        document.body.appendChild(modal);
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
                        window.copyShareUrl = async function(element, url) {
                            try {
                                let copySuccess = false;
                                
                                // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                                try {
                                    if (navigator.clipboard && window.isSecureContext) {
                                        await navigator.clipboard.writeText(url);
                                        copySuccess = true;
                                    }
                                } catch (e) {
                                    console.log('Clipboard API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e);
                                }
                                
                                if (!copySuccess) {
                                    try {
                                        const textArea = document.createElement('textarea');
                                        textArea.value = url;
                                        textArea.style.position = 'fixed';
                                        textArea.style.left = '-999999px';
                                        textArea.style.top = '-999999px';
                                        document.body.appendChild(textArea);
                                        textArea.focus();
                                        textArea.select();
                                        copySuccess = document.execCommand('copy');
                                        document.body.removeChild(textArea);
                                    } catch (e) {
                                        console.log('execCommand –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e);
                                    }
                                }
                                
                                if (copySuccess) {
                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
                                    element.style.background = '#d4edda';
                                    element.style.borderColor = '#c3e6cb';
                                    element.style.color = '#155724';
                                    
                                    const statusElement = document.getElementById('copyStatus');
                                    statusElement.innerHTML = '‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!';
                                    statusElement.style.color = '#28a745';
                                    
                                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –≤–∏–¥ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                                    setTimeout(() => {
                                        element.style.background = '#f8f9fa';
                                        element.style.borderColor = '#dee2e6';
                                        element.style.color = '#495057';
                                        statusElement.innerHTML = '&nbsp;';
                                        statusElement.style.color = '#6c757d';
                                    }, 2000);
                                } else {
                                    // –ï—Å–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å - –ø—Ä–æ—Å—Ç–æ –≤—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç
                                    const range = document.createRange();
                                    range.selectNodeContents(element);
                                    const selection = window.getSelection();
                                    selection.removeAllRanges();
                                    selection.addRange(range);
                                    
                                    const statusElement = document.getElementById('copyStatus');
                                    statusElement.innerHTML = 'üìã –°—Å—ã–ª–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ - —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é (Ctrl+C)';
                                    statusElement.style.color = '#ffc107';
                                }
                                
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏:', error);
                                
                                // –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç
                                const range = document.createRange();
                                range.selectNodeContents(element);
                                const selection = window.getSelection();
                                selection.removeAllRanges();
                                selection.addRange(range);
                            }
                        };
                        
                        shareDiaryBtn.innerHTML = '‚úÖ –°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!';
                    }
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        shareDiaryBtn.innerHTML = originalText;
                        shareDiaryBtn.disabled = false;
                    }, 3000);
                } else {
                    throw new Error(result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏:', error);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                const shareDiaryBtn = document.getElementById('shareDiaryBtn');
                shareDiaryBtn.innerHTML = 'üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –¥–Ω–µ–≤–Ω–∏–∫–æ–º';
                shareDiaryBtn.disabled = false;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                alert(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Å—ã–ª–∫–∏: ${error.message}`);
            }
        }
        
        async function loadDiaryData(userId) {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–Ω–µ–≤–Ω–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
                
                // –í—ã—á–∏—Å–ª—è–µ–º –¥–∞—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + currentDayOffset);
                const dateStr = targetDate.toISOString().split('T')[0];
                
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä API –∫–ª–∏–µ–Ω—Ç–∞
                const apiClient = new TelegramBotApiClient();
                const diaryData = await apiClient.getDiary(userId, dateStr);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await renderDiaryData(diaryData);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–Ω–µ–≤–Ω–∏–∫–∞:', error);
                document.getElementById('diary-content').innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="color: #999; font-size: 48px; margin-bottom: 20px;"></i>
                        </div>
                        <h3 style="color: #333; margin: 0 0 30px 0; font-weight: 500;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
                        <button onclick="location.reload()" style="
                            background: #6c757d;
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 16px 32px;
                            font-size: 16px;
                            font-weight: 500;
                            cursor: pointer;
                            transition: background-color 0.2s ease;
                            display: inline-flex;
                            align-items: center;
                            gap: 8px;
                        " onmouseover="this.style.background='#5a6268'" onmouseout="this.style.background='#6c757d'">
                            <i class="fas fa-sync-alt"></i>
                            –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        </button>
                    </div>
                `;
            }
        }
           /**
         * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞
         */
        async function renderDiaryData(data) {
            const container = document.getElementById('diary-content');
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const date = new Date(data.date);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            let dateLabel = '';
            if (date.toDateString() === today.toDateString()) {
                dateLabel = '–°–µ–≥–æ–¥–Ω—è';
            } else if (date.toDateString() === yesterday.toDateString()) {
                dateLabel = '–í—á–µ—Ä–∞';
            } else if (date.toDateString() === tomorrow.toDateString()) {
                dateLabel = '–ó–∞–≤—Ç—Ä–∞';
            } else {
                dateLabel = date.toLocaleDateString('ru-RU', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–ª—è –≤—Å–µ—Ö –±–ª—é–¥
            const userId = getUserId();
            const favoritesStatus = {};
            
            if (data.meals && data.meals.length > 0) {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–ª—è –≤—Å–µ—Ö –±–ª—é–¥ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
                    const favoriteChecks = await Promise.all(
                        data.meals.map(meal => 
                            fetch(`https://telegram-bot-api-h136.onrender.com/favorites/${userId}/check/${meal.id}`)
                                .then(response => response.ok ? response.json() : { meal_id: meal.id, is_favorite: false })
                                .catch(() => ({ meal_id: meal.id, is_favorite: false }))
                        )
                    );
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –æ–±—ä–µ–∫—Ç
                    favoriteChecks.forEach(check => {
                        favoritesStatus[check.meal_id] = check.is_favorite;
                    });
                    
                    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω —Å—Ç–∞—Ç—É—Å –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', favoritesStatus);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –∫ –∫–∞–∂–¥–æ–º—É –±–ª—é–¥—É
            if (data.meals) {
                data.meals.forEach(meal => {
                    meal.isFavorite = favoritesStatus[meal.id] || false;
                });
            }
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–Ω—è–º
            const isToday = currentDayOffset === 0;
            const rightButtonStyle = isToday 
                ? "background: rgba(150,150,150,0.4); border: none; color: rgba(255,255,255,0.6); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: not-allowed;"
                : "background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;";
            
            const navigationHtml = `
                <div class="date-navigator" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #7a9b8e 0%, #6b8b7d 100%); border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(122, 155, 142, 0.3);">
                    <button onclick="navigateDay(-1)" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                        ‚Äπ
                    </button>
                    <h3 style="margin: 0; font-weight: 600; text-align: center;">${dateLabel}</h3>
                    <button onclick="navigateDay(1)" style="${rightButtonStyle}">
                        ‚Ä∫
                    </button>
                </div>
            `;
            
            // –ü–∞–Ω–µ–ª—å —Å –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            const caloriesPercent = Math.round((data.total_calories / data.targets.calories) * 100);
            const proteinPercent = Math.round((data.total_protein / data.targets.protein) * 100);
            const fatPercent = Math.round((data.total_fat / data.targets.fat) * 100);
            const carbPercent = Math.round((data.total_carb / data.targets.carb) * 100);
            const fiberPercent = Math.round((data.total_fiber / data.targets.fiber) * 100);
            
            const summaryHtml = `
                <div class="card" style="background: linear-gradient(135deg, #7a9b8e 0%, #6b8b7d 100%); color: white; border: none; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(122, 155, 142, 0.3);">
                    <div class="card-header" style="background: rgba(255, 255, 255, 0.1); border-bottom: 1px solid rgba(255, 255, 255, 0.2); color: white;">
                        <h5 class="mb-0">üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <!-- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–∞–ª–æ—Ä–∏–π -->
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="position: relative; display: inline-block;">
                                <svg width="120" height="120" style="transform: rotate(-90deg);">
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="8"/>
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="white" stroke-width="8" 
                                            stroke-dasharray="${2 * Math.PI * 50}" 
                                            stroke-dashoffset="${2 * Math.PI * 50 * (1 - Math.min(caloriesPercent / 100, 1))}"
                                            style="transition: stroke-dashoffset 0.5s ease;"/>
                                </svg>
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                    <div style="font-size: 1.2rem; font-weight: 700;">${data.total_calories}</div>
                                    <div style="font-size: 0.8rem; opacity: 0.9;">–∏–∑ ${data.targets.calories}</div>
                                    <div style="font-size: 0.7rem; opacity: 0.8;">–∫–∫–∞–ª</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –ë–ñ–£ -->
                        <div class="row">
                            <div class="col-6 mb-3">
                                <div style="font-size: 0.9rem; margin-bottom: 5px;">–ë–µ–ª–∫–∏: ${data.total_protein}–≥ / ${data.targets.protein}–≥</div>
                                <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: white; height: 100%; width: ${Math.min(proteinPercent, 100)}%; transition: width 0.5s ease;"></div>
                                </div>
                                <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 2px;">${proteinPercent}%</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div style="font-size: 0.9rem; margin-bottom: 5px;">–ñ–∏—Ä—ã: ${data.total_fat}–≥ / ${data.targets.fat}–≥</div>
                                <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: white; height: 100%; width: ${Math.min(fatPercent, 100)}%; transition: width 0.5s ease;"></div>
                                </div>
                                <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 2px;">${fatPercent}%</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div style="font-size: 0.9rem; margin-bottom: 5px;">–£–≥–ª–µ–≤–æ–¥—ã: ${data.total_carb}–≥ / ${data.targets.carb}–≥</div>
                                <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: white; height: 100%; width: ${Math.min(carbPercent, 100)}%; transition: width 0.5s ease;"></div>
                                </div>
                                <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 2px;">${carbPercent}%</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div style="font-size: 0.9rem; margin-bottom: 5px;">–ö–ª–µ—Ç—á–∞—Ç–∫–∞: ${data.total_fiber}–≥ / ${data.targets.fiber}–≥</div>
                                <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div style="background: white; height: 100%; width: ${Math.min(fiberPercent, 100)}%; transition: width 0.5s ease;"></div>
                                </div>
                                <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 2px;">${fiberPercent}%</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // –ü—Ä–∏–µ–º—ã –ø–∏—â–∏
            let mealsHtml = '';
            if (data.meals && data.meals.length > 0) {
                mealsHtml = `
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">üçΩÔ∏è –ü—Ä–∏–µ–º—ã –ø–∏—â–∏</h5>
                        </div>
                        <div class="card-body">
                `;
                
                data.meals.forEach(meal => {
                    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                    console.log(`Meal ${meal.id}: image = ${meal.image ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}`);
                    
                    // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞
                    let imageHtml = '';
                    if (meal.image && meal.image.trim() !== '') {
                        imageHtml = `
                            <img src="data:image/jpeg;base64,${meal.image}" 
                                 alt="–§–æ—Ç–æ –±–ª—é–¥–∞" 
                                 class="meal-image" 
                                 onclick="showImageModal('${meal.image}')"
                                 title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è"
                                 onerror="console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏ ${meal.id}')">
                        `;
                    } else {
                        imageHtml = `
                            <div class="meal-image-placeholder">
                                üçΩÔ∏è
                            </div>
                        `;
                    }
                    
                    mealsHtml += `
                        <div class="meal-item" style="background: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 10px; border-left: 4px solid var(--tg-theme-button-color, #4d6073);">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="d-flex align-items-start" style="flex: 1;">
                                    ${imageHtml}
                                    <div style="flex: 1;">
                                        <div class="meal-time" style="font-weight: 600; color: var(--tg-theme-button-color, #4d6073); font-size: 0.9rem;">${meal.time}</div>
                                        <div class="meal-description" style="margin: 5px 0; color: #333;">${meal.description}</div>
                                        <div class="meal-calories" style="font-size: 0.9rem; color: #666;">
                                            ${meal.calories} –∫–∫–∞–ª ‚Ä¢ –ë: ${meal.protein}–≥ ‚Ä¢ –ñ: ${meal.fat}–≥ ‚Ä¢ –£: ${meal.carb}–≥
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex align-items-start" style="gap: 8px;">
                                    <button class="btn btn-sm ${meal.isFavorite ? 'btn-warning' : 'btn-outline-warning'}" 
                                            onclick="toggleFavorite(${meal.id})" 
                                            id="favorite-btn-${meal.id}"
                                            title="${meal.isFavorite ? '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'}"
                                            style="min-width: 40px;">
                                        ${meal.isFavorite ? '‚≠ê' : '‚òÜ'}
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="toggleMealDetails(${meal.id})">
                                        –î–µ—Ç–∞–ª–∏
                                    </button>
                                </div>
                            </div>
                            <div id="meal-details-${meal.id}" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                                <h6>–°–æ—Å—Ç–∞–≤:</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>–ü—Ä–æ–¥—É–∫—Ç</th>
                                                <th>–í–µ—Å</th>
                                                <th>–ö–∞–ª–æ—Ä–∏–∏</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                    `;
                    
                    if (meal.items && meal.items.length > 0) {
                        meal.items.forEach(item => {
                            mealsHtml += `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>${item.weight}</td>
                                    <td>${item.calories} –∫–∫–∞–ª</td>
                                </tr>
                            `;
                        });
                    } else {
                        mealsHtml += `
                            <tr>
                                <td colspan="3" class="text-muted">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</td>
                            </tr>
                        `;
                    }
                    
                    mealsHtml += `
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-3 text-center">
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMeal('${meal.timestamp}', ${meal.id})" style="border-radius: 20px;">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                mealsHtml += `
                        </div>
                    </div>
                `;
            } else {
                mealsHtml = `
                    <div class="card" style="background: #f8f9fa; border: 1px solid #e9ecef; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                        <div class="card-body text-center">
                            <div class="empty-icon" style="font-size: 48px; margin-bottom: 16px; color: #6c757d;">üçΩÔ∏è</div>
                            <h5 style="color: #495057;">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –ø–∏—Ç–∞–Ω–∏–∏</h5>
                            <p style="color: #6c757d;">–í —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –±–ª—é–¥–∞.</p>
                        </div>
                    </div>
                `;
            }
            
            // –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            let debugMessage = '';
            if (data.message) {
                debugMessage = `
                    <div class="alert alert-info" style="margin-bottom: 20px; color: #6c757d !important;">
                        <i class="fas fa-info-circle" style="color: #6c757d !important;"></i> ${data.message}
                    </div>
                `;
            }
            
            container.innerHTML = navigationHtml + debugMessage + summaryHtml + mealsHtml;
        }
        
        /**
         * –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–Ω—è–º
         */
        function navigateDay(direction) {
            // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –≤ –±—É–¥—É—â–µ–µ (direction = 1) –∫–æ–≥–¥–∞ —É–∂–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–º –¥–Ω–µ
            if (direction === 1 && currentDayOffset === 0) {
                console.log('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –±—É–¥—É—â–µ–µ –∑–∞–ø—Ä–µ—â–µ–Ω');
                return;
            }
            
            currentDayOffset += direction;
            loadDiaryData(getUserId());
        }
        
        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
         */
        function toggleMealDetails(mealId) {
            const detailsElement = document.getElementById(`meal-details-${mealId}`);
            if (detailsElement) {
                detailsElement.style.display = detailsElement.style.display === 'none' ? 'block' : 'none';
            }
        }

        /**
         * –£–¥–∞–ª–µ–Ω–∏–µ –±–ª—é–¥–∞
         */
        async function deleteMeal(timestamp, mealId) {
            const userId = getUserId();
            if (!userId) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }

            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±–ª—é–¥–æ? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }

            try {
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä API –∫–ª–∏–µ–Ω—Ç–∞
                const apiClient = new TelegramBotApiClient();
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DELETE –∑–∞–ø—Ä–æ—Å
                const response = await fetch(`${apiClient.apiBaseUrl}/meal/${userId}/${encodeURIComponent(timestamp)}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': apiClient.apiKey
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.status === 'success') {
                    // –û—á–∏—â–∞–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫—ç—à
                    dataCache.clear();
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫—ç—à —á–µ—Ä–µ–∑ API
                    try {
                        await fetch(`${apiClient.apiBaseUrl}/cache/clear/${userId}`, {
                            method: 'DELETE',
                            headers: {
                                'X-API-Key': apiClient.apiKey
                            }
                        });
                    } catch (e) {
                        console.log('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫—ç—à–∞:', e.message);
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏
                    alert('‚úÖ –ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!');
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    await loadDiaryData(userId);
                    
                    // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
                    if (document.getElementById('stats-section').style.display !== 'none') {
                        await loadStatsData(userId);
                    }
                } else {
                    throw new Error(result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞: ' + error.message);
            }
        }

        async function loadRecipesData(userId) {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –±–ª—é–¥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –Ω–µ–¥–µ–ª—è–º
        let currentWeekOffset = 0;
        
        /**
         * –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º
         */
        function navigateWeek(direction) {
            // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –≤ –±—É–¥—É—â–µ–µ (direction = 1) –∫–æ–≥–¥–∞ —É–∂–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º –ø–µ—Ä–∏–æ–¥–µ
            if (direction === 1 && currentWeekOffset === 0) {
                console.log('–ü–µ—Ä–µ—Ö–æ–¥ –≤ –±—É–¥—É—â–µ–µ –∑–∞–ø—Ä–µ—â–µ–Ω');
                return;
            }
            
            currentWeekOffset += direction;
            updateWeekDisplay();
            loadStatsData(getUserId());
        }
        
        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ–¥–µ–ª–∏ (—Å–∫–æ–ª—å–∑—è—â–∏–µ 7 –¥–Ω–µ–π)
         */
        function updateWeekDisplay() {
            const weekRange = document.getElementById('weekRange');
            const nextWeekBtn = document.getElementById('nextWeekBtn');
            if (!weekRange) return;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É –∂–µ –ª–æ–≥–∏–∫—É —á—Ç–æ –∏ –≤ generateWeekDates
            const endDate = new Date(); // –°–µ–≥–æ–¥–Ω—è - —ç—Ç–æ –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞
            endDate.setDate(endDate.getDate() + (currentWeekOffset * 7));
            
            const startDate = new Date(endDate);
            startDate.setDate(endDate.getDate() - 6); // 6 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç –∫–æ–Ω–µ—á–Ω–æ–π –¥–∞—Ç—ã
            
            const formatDate = (date) => {
                return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
            };
            
            if (currentWeekOffset === 0) {
                weekRange.textContent = '–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π';
            } else {
                weekRange.textContent = `${formatDate(startDate)} - ${formatDate(endDate)}`;
            }
            
            // –£–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ "—Å–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è"
            if (nextWeekBtn) {
                if (currentWeekOffset === 0) {
                    // –ù–∞ —Ç–µ–∫—É—â–µ–º –ø–µ—Ä–∏–æ–¥–µ - –¥–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º
                    nextWeekBtn.style.background = 'rgba(150,150,150,0.4)';
                    nextWeekBtn.style.color = 'rgba(255,255,255,0.6)';
                    nextWeekBtn.style.cursor = 'not-allowed';
                    nextWeekBtn.disabled = true;
                } else {
                    // –ù–∞ –ø—Ä–æ—à–ª—ã—Ö –ø–µ—Ä–∏–æ–¥–∞—Ö - –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
                    nextWeekBtn.style.background = 'rgba(255,255,255,0.2)';
                    nextWeekBtn.style.color = 'white';
                    nextWeekBtn.style.cursor = 'pointer';
                    nextWeekBtn.disabled = false;
                }
            }
            
            console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å –Ω–µ–¥–µ–ª–∏ (offset=${currentWeekOffset}): ${weekRange.textContent}`);
        }
        
        /**
         * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
         */
        async function renderStatsWithCharts(statsData) {
            // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            const statsContent = document.getElementById('stats-content');
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–µ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–Ω–µ–≤–Ω–∏–∫–∞
            const weekDates = generateWeekDates(currentWeekOffset);
            const weekData = await generateWeekData(weekDates, statsData, getUserId());
            
            statsContent.innerHTML = `
                <style>
                .macro-card {
                    background-color: #fff;
                    border-radius: 12px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    padding: 20px 0;
                    margin: 20px -20px;
                    border: 1px solid rgba(0, 0, 0, 0.05);
                }
                .macro-card h3 {
                    color: #333;
                    margin-bottom: 15px;
                    font-weight: 600;
                    font-size: 1.2rem;
                    padding: 0 20px;
                }
                .macro-card p {
                    color: #666;
                    margin-bottom: 15px;
                    font-size: 0.9rem;
                    padding: 0 20px;
                }
                .macro-card canvas {
                    height: 200px !important;
                    width: 100% !important;
                    margin: 0 !important;
                    padding: 0 !important;
                }
                </style>
                
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ -->
                <div class="macro-card">
                    <h3>–ö–∞–ª–æ—Ä–∏–∏ üî• <small style="font-size: 13px;">–¶–µ–ª—å: ${statsData.user_targets?.calories || 2000} –∫–∫–∞–ª</small></h3>
                    <p>–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥–µ–Ω—å: <strong>${Math.round(weekData.calories.reduce((a, b) => a + b, 0) / 7)} –∫–∫–∞–ª</strong></p>
                    <canvas id="caloriesChart"></canvas>
                </div>

                <div class="macro-card">
                    <h3>–ë–µ–ª–∫–∏ üí™ <small style="font-size: 13px;">–¶–µ–ª—å: ${statsData.user_targets?.protein || 100} –≥.</small></h3>
                    <p>–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥–µ–Ω—å: <strong>${Math.round(weekData.proteins.reduce((a, b) => a + b, 0) / 7)} –≥</strong></p>
                    <canvas id="proteinsChart"></canvas>
                </div>

                <div class="macro-card">
                    <h3>–ñ–∏—Ä—ã üßà <small style="font-size: 13px;">–¶–µ–ª—å: ${statsData.user_targets?.fat || 67} –≥.</small></h3>
                    <p>–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥–µ–Ω—å: <strong>${Math.round(weekData.fats.reduce((a, b) => a + b, 0) / 7)} –≥</strong></p>
                    <canvas id="fatsChart"></canvas>
                </div>

                <div class="macro-card">
                    <h3>–£–≥–ª–µ–≤–æ–¥—ã üçû <small style="font-size: 13px;">–¶–µ–ª—å: ${statsData.user_targets?.carb || 250} –≥.</small></h3>
                    <p>–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥–µ–Ω—å: <strong>${Math.round(weekData.carbs.reduce((a, b) => a + b, 0) / 7)} –≥</strong></p>
                    <canvas id="carbsChart"></canvas>
                </div>

                <div class="macro-card" style="margin-bottom: 30px;">
                    <h3>–ö–ª–µ—Ç—á–∞—Ç–∫–∞ üåæ <small style="font-size: 13px;">–¶–µ–ª—å: ${statsData.user_targets?.fiber || 25} –≥</small></h3>
                    <p>–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥–µ–Ω—å: <strong>${Math.round(weekData.fiber.reduce((a, b) => a + b, 0) / 7)} –≥</strong></p>    
                    <canvas id="fiberChart"></canvas>
                </div>
            `;
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
            setTimeout(() => {
                createCharts(weekDates, weekData, statsData.user_targets);
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                updateWeekDisplay();
            }, 100);
        }
        
        /**
         * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞—Ç –¥–ª—è –Ω–µ–¥–µ–ª–∏ (—Å–∫–æ–ª—å–∑—è—â–∏–µ 7 –¥–Ω–µ–π –æ—Ç —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã)
         */
        function generateWeekDates(weekOffset) {
            const dates = [];
            const endDate = new Date(); // –°–µ–≥–æ–¥–Ω—è - —ç—Ç–æ –∫–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞
            
            // –°–¥–≤–∏–≥–∞–µ–º –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É –Ω–∞ weekOffset * 7 –¥–Ω–µ–π
            endDate.setDate(endDate.getDate() + (weekOffset * 7));
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç –∫–æ–Ω–µ—á–Ω–æ–π –¥–∞—Ç—ã
            for (let i = 6; i >= 0; i--) {
                const date = new Date(endDate);
                date.setDate(endDate.getDate() - i);
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å daily_data
                dates.push(date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' }));
            }
            
            console.log(`–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã (—Å–∫–æ–ª—å–∑—è—â–∏–µ 7 –¥–Ω–µ–π, offset=${weekOffset}):`, dates);
            return dates;
        }
        
          /**
         * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–µ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
         */
        async function generateWeekData(dates, statsData, userId) {
            // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–∞
            const calories = [];
            const proteins = [];
            const fats = [];
            const carbs = [];
            const fiber = [];
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ statsData.daily_data –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
            if (statsData.daily_data && statsData.daily_data.length > 0) {
                // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                
                // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É –¥–∞—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
                const dataMap = {};
                for (const dayData of statsData.daily_data) {
                    dataMap[dayData.date] = dayData;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –¥–∞—Ç—ã –Ω–µ–¥–µ–ª–∏
                for (const date of dates) {
                    const dayData = dataMap[date];
                    if (dayData) {
                        // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                        calories.push(Math.round(dayData.calories || 0));
                        proteins.push(Math.round(dayData.protein || 0));
                        fats.push(Math.round(dayData.fat || 0));
                        carbs.push(Math.round(dayData.carb || 0));
                        fiber.push(Math.round(dayData.fiber || 0));
                    } else {
                        // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                        calories.push(0);
                        proteins.push(0);
                        fats.push(0);
                        carbs.push(0);
                        fiber.push(0);
                    }
                }
            } else {
                // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö - –∑–∞–ø–æ–ª–Ω—è–µ–º –Ω—É–ª—è–º–∏
                for (let i = 0; i < 7; i++) {
                    calories.push(0);
                    proteins.push(0);
                    fats.push(0);
                    carbs.push(0);
                    fiber.push(0);
                }
            }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            
            return {
                calories: calories,
                proteins: proteins,
                fats: fats,
                carbs: carbs,
                fiber: fiber
            };
        }
        
        /**
         * –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –≤ —Å—Ç–∏–ª–µ Apple Health (—Ç–æ—á–Ω–∞—è –∫–æ–ø–∏—è)
         */
        function createCharts(dates, data, targets) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Chart.js –∑–∞–≥—Ä—É–∂–µ–Ω
            if (!window.Chart) {
                console.error('Chart.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω! –ì—Ä–∞—Ñ–∏–∫–∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã.');
                return;
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Chart.js –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —à—Ä–∏—Ñ—Ç–æ–≤
            Chart.defaults.font.family = 'Manrope, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
            Chart.defaults.font.weight = '400';
            Chart.defaults.font.lineHeight = 1.2;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—ã –≤ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏
            const dayNames = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
            const weekDays = dates.map(dateStr => {
                // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY
                const [day, month, year] = dateStr.split('.');
                const date = new Date(year, month - 1, day);
                return dayNames[date.getDay()];
            });
            
            console.log('–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞—Ç—ã:', dates);
            console.log('–î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π:', weekDays);
            console.log('–¶–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ª–∏–Ω–∏–π:', targets);
            
            // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å –ø–ª–∞–≤–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –º–µ–∂–¥—É –∑–æ–Ω–∞–º–∏
            const createHealthGradient = (canvasCtx, chartHeight) => {
                const gradient = canvasCtx.createLinearGradient(0, 0, 0, chartHeight);
                
                // –ö—Ä–∞—Å–∏–≤—ã–µ —Ü–≤–µ—Ç–∞ —Å –ø–ª–∞–≤–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
                gradient.addColorStop(0.0, '#E74C3C');    // –ö—Ä–∞—Å–∏–≤—ã–π –∫—Ä–∞—Å–Ω—ã–π (–≤—ã—à–µ 100%)
                gradient.addColorStop(0.1, '#E67E22');    // –û—Ä–∞–Ω–∂–µ–≤–æ-–∫—Ä–∞—Å–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
                gradient.addColorStop(0.15, '#F39C12');   // –û—Ä–∞–Ω–∂–µ–≤—ã–π (100%)
                gradient.addColorStop(0.75, '#F1C40F');   // –ñ–µ–ª—Ç—ã–π (85-100%)
                gradient.addColorStop(0.85, '#7a9b8e');   // –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∑–µ–ª–µ–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
                gradient.addColorStop(1.0, '#7a9b8e');    // –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∑–µ–ª–µ–Ω—ã–π (–¥–æ 85%)
                
                return gradient;
            };
            
            const config = [
                {
                    element: 'caloriesChart',
                    data: data.calories,
                    targetValue: targets?.calories || 2000,
                    icon: 'üî•'
                },
                {
                    element: 'proteinsChart',
                    data: data.proteins,
                    targetValue: targets?.protein || 100,
                    icon: 'üí™'
                },
                {
                    element: 'fatsChart',
                    data: data.fats,
                    targetValue: targets?.fat || 67,
                    icon: 'üßà'
                },
                {
                    element: 'carbsChart',
                    data: data.carbs,
                    targetValue: targets?.carb || 250,
                    icon: 'üçû'
                },
                {
                    element: 'fiberChart',
                    data: data.fiber,
                    targetValue: targets?.fiber || 25,
                    icon: 'üåæ'
                }
            ];

            config.forEach(function(chartConfig) {
                const ctx = document.getElementById(chartConfig.element);
                if (!ctx) return;
                
                const canvasCtx = ctx.getContext('2d');
                
                // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞
                const backgroundColors = chartConfig.data.map((value, index) => {
                    const percentage = (value / chartConfig.targetValue) * 100;
                    
                    // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ (–æ—Ç –≤–µ—Ä—Ö–∞ –∫ –Ω–∏–∑—É)
                    const gradient = canvasCtx.createLinearGradient(0, 0, 0, 400);
                    
                    if (percentage <= 85) {
                        // –°–ª—É—á–∞–π 1: –î–æ 85% - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–µ–ª–µ–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü
                        gradient.addColorStop(0, '#7a9b8e');
                        gradient.addColorStop(1, '#7a9b8e');
                        
                    } else if (percentage <= 100) {
                        // –°–ª—É—á–∞–π 2: 85-100% - –∑–µ–ª–µ–Ω—ã–π —Å–Ω–∏–∑—É, –∂–µ–ª—Ç—ã–π —Å–≤–µ—Ä—Ö—É
                        gradient.addColorStop(0, '#F1C40F');      // –í–µ—Ä—Ö - –∂–µ–ª—Ç—ã–π
                        gradient.addColorStop(0.2, '#F1C40F');    // 20% –∂–µ–ª—Ç–æ–≥–æ —Å–≤–µ—Ä—Ö—É
                        gradient.addColorStop(0.3, '#7a9b8e');    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–µ–ª–µ–Ω–æ–º—É
                        gradient.addColorStop(1, '#7a9b8e');      // 70% –∑–µ–ª–µ–Ω–æ–≥–æ —Å–Ω–∏–∑—É
                        
                    } else {
                        // –°–ª—É—á–∞–π 3: –í—ã—à–µ 100% - –∫—Ä–∞—Å–Ω—ã–π —Å–≤–µ—Ä—Ö—É, –∂–µ–ª—Ç—ã–π –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ, –∑–µ–ª–µ–Ω—ã–π —Å–Ω–∏–∑—É
                        const greenPortion = 85 / percentage;    // –î–æ–ª—è –∑–µ–ª–µ–Ω–æ–≥–æ (–¥–æ 85%)
                        const yellowPortion = 15 / percentage;   // –î–æ–ª—è –∂–µ–ª—Ç–æ–≥–æ (85-100%)
                        
                        gradient.addColorStop(0, '#E74C3C');                           // –í–µ—Ä—Ö - –∫—Ä–∞—Å–Ω—ã–π
                        gradient.addColorStop(1 - greenPortion - yellowPortion, '#E74C3C'); // –ö—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞
                        gradient.addColorStop(1 - greenPortion - yellowPortion + 0.05, '#F1C40F'); // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∂–µ–ª—Ç–æ–º—É
                        gradient.addColorStop(1 - greenPortion, '#F1C40F');            // –ñ–µ–ª—Ç–∞—è –∑–æ–Ω–∞
                        gradient.addColorStop(1 - greenPortion + 0.05, '#7a9b8e');     // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–µ–ª–µ–Ω–æ–º—É
                        gradient.addColorStop(1, '#7a9b8e');                          // –ó–µ–ª–µ–Ω–∞—è –∑–æ–Ω–∞
                    }
                    
                    return gradient;
                });
                
                // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —Å —Ü–µ–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
                const targetLine = new Array(weekDays.length).fill(chartConfig.targetValue);
                
                new Chart(canvasCtx, {
                    type: 'bar',
                    data: {
                        labels: weekDays,
                        datasets: [
                            {
                                type: 'bar',
                                label: '–î–∞–Ω–Ω—ã–µ',
                                data: chartConfig.data,
                                backgroundColor: backgroundColors,
                                borderColor: 'transparent',
                                borderWidth: 0,
                                borderRadius: 4,
                                borderSkipped: false,
                                barThickness: 16,
                                categoryPercentage: 1.0,
                                barPercentage: 0.6
                            },
                            {
                                type: 'line',
                                label: '–¶–µ–ª—å',
                                data: targetLine,
                                borderColor: '#98989D',
                                backgroundColor: 'transparent',
                                borderWidth: 2,
                                pointRadius: 0,
                                pointHoverRadius: 0,
                                fill: false,
                                tension: 0,
                                borderDash: [6, 6]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        },
                        layout: {
                            padding: {
                                top: 10,
                                bottom: 5,
                                left: 0,
                                right: 0
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: true,
                                    drawBorder: false,
                                    color: 'rgba(152, 152, 157, 0.3)',
                                    borderDash: [2, 2],
                                    lineWidth: 1
                                },
                                border: {
                                    display: false
                                },
                                ticks: {
                                    color: '#8E8E93',
                                    font: {
                                        size: window.innerWidth < 768 ? 14 : 16,
                                        weight: '400',
                                        family: 'Manrope, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
                                    },
                                    maxRotation: 0,
                                    padding: 15,
                                    textStrokeColor: 'transparent',
                                    textStrokeWidth: 0
                                }
                            },
                            y: {
                                beginAtZero: true,
                                position: 'right',
                                border: {
                                    display: false
                                },
                                grid: {
                                    color: 'rgba(152, 152, 157, 0.2)',
                                    borderDash: [],
                                    lineWidth: 1,
                                    drawBorder: false
                                },
                                ticks: {
                                    color: '#8E8E93',
                                    font: {
                                        size: window.innerWidth < 768 ? 13 : 15,
                                        weight: '400',
                                        family: 'Manrope, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
                                    },
                                    padding: 15,
                                    maxTicksLimit: 4,
                                    textStrokeColor: 'transparent',
                                    textStrokeWidth: 0,
                                    callback: function(value) {
                                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞ –∫–∞–∫ –≤ Apple (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –¥–ª—è —Ç—ã—Å—è—á)
                                        return Math.round(value).toLocaleString('ru-RU');
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: true,
                                backgroundColor: 'rgba(28, 28, 30, 0.95)',
                                titleColor: '#FFFFFF',
                                bodyColor: '#FFFFFF',
                                borderColor: 'transparent',
                                borderWidth: 0,
                                cornerRadius: 16,
                                displayColors: false,
                                titleFont: {
                                    size: window.innerWidth < 768 ? 15 : 17,
                                    weight: '500',
                                    family: 'Manrope, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
                                },
                                bodyFont: {
                                    size: window.innerWidth < 768 ? 14 : 16,
                                    weight: '400',
                                    family: 'Manrope, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
                                },
                                padding: 20,
                                caretSize: 10,
                                callbacks: {
                                    title: function(context) {
                                        return `${chartConfig.icon} ${context[0].label}`;
                                    },
                                    label: function(context) {
                                        if (context.datasetIndex === 0) {
                                            const percentage = Math.round((context.parsed.y / chartConfig.targetValue) * 100);
                                            return `${context.parsed.y} (${percentage}% –æ—Ç —Ü–µ–ª–∏)`;
                                        } else {
                                            return `–¶–µ–ª—å: ${context.parsed.y}`;
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function showImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            modalImg.src = `data:image/jpeg;base64,${imageSrc}`;
            modal.style.display = 'block';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('imageModal');
            const closeBtn = document.querySelector('.image-modal-close');
            const modalImg = document.getElementById('modalImage');
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
            if (closeBtn) {
                closeBtn.onclick = function(event) {
                    event.stopPropagation();
                    modal.style.display = 'none';
                }
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (modalImg) {
                modalImg.onclick = function(event) {
                    event.stopPropagation();
                    modal.style.display = 'none';
                }
            }
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            modal.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }
        });

        // ==================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –í–ï–°–û–ú ====================

        let currentWeightPeriod = 'month';
        let weightChart = null;

        /**
         * –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Å–µ
         */
        async function loadWeightData(userId, period = 'month') {
            const weightContent = document.getElementById('weight-content');
            
            try {
                const apiClient = new TelegramBotApiClient();
                
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –∫—ç—à –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const cacheKeys = [
                    `weight_${userId}_week`,
                    `weight_${userId}_month`,
                    `weight_${userId}_6months`,
                    `weight_${userId}_year`,
                    `profile_${userId}`
                ];
                cacheKeys.forEach(key => dataCache.delete(key));
                
                const weightData = await apiClient.getWeightHistory(userId, period);
                
                
                renderWeightData(weightData, period);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Å–µ:', error);
                weightContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle" style="color: #999; font-size: 48px; margin-bottom: 20px;"></i>
                        </div>
                        <h3 style="color: #333; margin: 0 0 30px 0; font-weight: 500;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Å–µ</h3>
                        <button onclick="location.reload()" style="
                            background: #6c757d;
                            color: white;
                            border: none;
                            border-radius: 12px;
                            padding: 16px 32px;
                            font-size: 16px;
                            font-weight: 500;
                            cursor: pointer;
                            transition: background-color 0.2s ease;
                            display: inline-flex;
                            align-items: center;
                            gap: 8px;
                        " onmouseover="this.style.background='#5a6268'" onmouseout="this.style.background='#6c757d'">
                            <i class="fas fa-sync-alt"></i>
                            –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        </button>
                    </div>
                `;
            }
        }

        /**
         * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –≤–µ—Å–µ
         */
        function renderWeightData(data, period) {
            
            const weightContent = document.getElementById('weight-content');
            const entries = data.entries || [];
            const currentWeight = data.current_weight;
            const goalWeight = data.goal_weight;
            const weightChange = data.weight_change;

            // –ö–∞—Ä—Ç–æ—á–∫–∞ —Å —Ç–µ–∫—É—â–∏–º –≤–µ—Å–æ–º
            let weightCardHtml = `
                <div class="weight-card">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="weight-current">${currentWeight ? currentWeight + ' –∫–≥' : '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            ${weightChange ? `
                                <div class="weight-change ${weightChange > 0 ? 'positive' : 'negative'}">
                                    ${weightChange > 0 ? '+' : ''}${weightChange} –∫–≥ –∑–∞ –ø–µ—Ä–∏–æ–¥
                                </div>
                            ` : ''}
                            ${goalWeight ? `
                                <div class="weight-goal">
                                    –¶–µ–ª—å: ${goalWeight} –∫–≥
                                </div>
                            ` : ''}
                        </div>
                        <div>
                            <i class="fas fa-weight" style="font-size: 2rem; opacity: 0.7;"></i>
                        </div>
                    </div>
                </div>
            `;

            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ—Å–∞
            let addButtonHtml = `
                <button class="add-weight-btn" data-bs-toggle="modal" data-bs-target="#addWeightModal">
                    <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–µ—Å
                </button>
            `;

            // –°–µ–ª–µ–∫—Ç–æ—Ä –ø–µ—Ä–∏–æ–¥–∞
            let periodSelectorHtml = `
                <div class="period-selector">
                    <button class="period-btn ${period === 'week' ? 'active' : ''}" onclick="changeWeightPeriod('week')">–ù–µ–¥–µ–ª—è</button>
                    <button class="period-btn ${period === 'month' ? 'active' : ''}" onclick="changeWeightPeriod('month')">–ú–µ—Å—è—Ü</button>
                    <button class="period-btn ${period === '6months' ? 'active' : ''}" onclick="changeWeightPeriod('6months')">6 –º–µ—Å</button>
                    <button class="period-btn ${period === 'year' ? 'active' : ''}" onclick="changeWeightPeriod('year')">–ì–æ–¥</button>
                </div>
            `;

            // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            let chartHtml = `
                <div class="weight-chart-container">
                    <canvas id="weightChart"></canvas>
                </div>
            `;

            // –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏
            let historyHtml = `
                <div class="weight-history-table">
                    <div class="weight-history-header">
                        <i class="fas fa-history me-2"></i>–ò—Å—Ç–æ—Ä–∏—è –≤–µ—Å–∞
                    </div>
            `;

            if (entries.length > 0) {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–ø–∏—Å–∏ –ø–æ timestamp –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
                const sortedEntries = [...entries].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                sortedEntries.forEach((entry, index) => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É –∑–∞–ø–∏—Å–∏ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π –≤–µ—Å
                    if (!entry.weight || entry.weight === null || entry.weight === undefined) {
                        return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å–∏ —Å null –≤–µ—Å–æ–º
                    }
                    
                    const entryDate = new Date(entry.date).toLocaleDateString('ru-RU', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric'
                    });
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–ø–∏—Å—å –ø–æ—Å–ª–µ–¥–Ω–µ–π (—Å–∞–º–æ–π –Ω–æ–≤–æ–π)
                    const isLatestEntry = index === 0; // entries —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —É–±—ã–≤–∞–Ω–∏—é –¥–∞—Ç—ã
                    
                    let changeHtml = '';
                    if (index < entries.length - 1) {
                        const prevWeight = entries[index + 1].weight;
                        if (prevWeight && prevWeight !== null) {
                            const change = entry.weight - prevWeight;
                            if (Math.abs(change) >= 0.1) {
                                changeHtml = `
                                    <span class="weight-entry-change ${change > 0 ? 'positive' : 'negative'}">
                                        ${change > 0 ? '+' : ''}${change.toFixed(1)} –∫–≥
                                    </span>
                                `;
                            }
                        }
                    }
                    
                    // –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
                    const deleteTooltip = isLatestEntry 
                        ? "–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏ –≤–µ—Ä–Ω—É—Ç—å –≤–µ—Å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é"
                        : "–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏";
                    
                    historyHtml += `
                        <div class="weight-entry">
                            <div>
                                <div class="weight-entry-date">${entryDate}</div>
                                ${entry.note ? `<small class="text-muted">${entry.note}</small>` : ''}
                            </div>
                            <div class="d-flex align-items-center">
                                <span class="weight-entry-value">${entry.weight} –∫–≥</span>
                                ${changeHtml}
                                <button class="weight-entry-delete" onclick="deleteWeightEntry('${entry.timestamp}', ${isLatestEntry})" title="${deleteTooltip}">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
            } else {
                historyHtml += `
                    <div class="weight-entry">
                        <div class="text-center text-muted py-3">
                            <i class="fas fa-weight fa-2x mb-2 d-block" style="opacity: 0.3;"></i>
                            –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –≤–µ—Å–µ
                        </div>
                    </div>
                `;
            }

            historyHtml += `</div>`;

            weightContent.innerHTML = weightCardHtml + addButtonHtml + periodSelectorHtml + chartHtml + historyHtml;
            
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è HTML
            setTimeout(() => {
                createWeightChart(entries, goalWeight);
            }, 100);
        }
        
        /**
         * –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤–µ—Å–∞ —á–µ—Ä–µ–∑ API
         * @param {string} timestamp - –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –∑–∞–ø–∏—Å–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
         * @param {boolean} isLatestEntry - –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–ø–∏—Å—å –ø–æ—Å–ª–µ–¥–Ω–µ–π
         */
        async function deleteWeightEntry(timestamp, isLatestEntry) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
            const confirmMessage = isLatestEntry 
                ? "–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –≤–µ—Å–∞? –¢–µ–∫—É—â–∏–π –≤–µ—Å –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ."
                : "–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –≤–µ—Å–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏?";
                
            if (!confirm(confirmMessage)) {
                return; // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª —É–¥–∞–ª–µ–Ω–∏–µ
            }
            
            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const weightContent = document.getElementById('weight-content');
                if (weightContent) {
                    weightContent.style.opacity = '0.6';
                    weightContent.style.pointerEvents = 'none';
                }
                
                const userId = getUserId();
                const apiClient = new TelegramBotApiClient();
                
                
                // –í—ã–∑—ã–≤–∞–µ–º API –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
                const result = await apiClient.deleteWeightEntry(userId, timestamp);
                
                
                if (result.success) {
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –∫—ç—à
                    const cacheKeys = [
                        `weight_${userId}_week`,
                        `weight_${userId}_month`,
                        `weight_${userId}_6months`,
                        `weight_${userId}_year`,
                        `profile_${userId}`
                    ];
                    cacheKeys.forEach(key => dataCache.delete(key));
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –≤–µ—Å–µ —Å —Ç–µ–∫—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º
                    await loadWeightData(userId, currentWeightPeriod);
                    
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                    const message = result.data?.is_latest_entry && result.data?.restored_weight
                        ? `–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞. –¢–µ–∫—É—â–∏–π –≤–µ—Å –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ ${result.data.restored_weight} –∫–≥.`
                        : "–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏.";
                    alert(message);
                } else {
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏: " + (result.error || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
                }
                
            } catch (error) {
                console.error('DEBUG: –û—à–∏–±–∫–∞ –≤ deleteWeightEntry:', error);
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏: " + error.message);
            } finally {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const weightContent = document.getElementById('weight-content');
                if (weightContent) {
                    weightContent.style.opacity = '1';
                    weightContent.style.pointerEvents = 'auto';
                }
            }
        }        
        /**
         * –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ –≤–µ—Å–∞
         */
        function createWeightChart(entries, goalWeight) {
            const ctx = document.getElementById('weightChart');
            if (!ctx) return;

            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –µ—Å—Ç—å
            if (weightChart) {
                weightChart.destroy();
            }

            if (entries.length === 0) {
                ctx.getContext('2d').clearRect(0, 0, ctx.width, ctx.height);
                const container = ctx.parentElement;
                container.innerHTML = `
                    <div class="chart-placeholder">
                        <i class="fas fa-chart-line"></i>
                        <p>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞</p>
                        <small class="text-muted">–î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –≤–µ—Å–∞</small>
                    </div>
                `;
                return;
            }

            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ timestamp, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –±—ã–ª–∏ —Å–ø—Ä–∞–≤–∞
            const sortedEntries = [...entries].sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            const labels = sortedEntries.map(entry => {
                const date = new Date(entry.date);
                return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
            });
            const weights = sortedEntries.map(entry => entry.weight);

            // –õ–∏–Ω–∏—è —Ü–µ–ª–∏
            const goalLine = goalWeight ? new Array(weights.length).fill(goalWeight) : [];

            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–í–µ—Å',
                            data: weights,
                            borderColor: '#7a9b8e',
                            backgroundColor: 'rgba(122, 155, 142, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#7a9b8e',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            fill: true,
                            tension: 0.4
                        },
                        ...(goalWeight ? [{
                            label: '–¶–µ–ª—å',
                            data: goalLine,
                            borderColor: '#ff6b6b',
                            backgroundColor: 'transparent',
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 0,
                            fill: false,
                            tension: 0,
                            borderDash: [6, 6]
                        }] : [])
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 750,
                        easing: 'easeInOutQuart'
                    },
                    scales: {
                        x: {
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: '#6c757d',
                                font: {
                                    size: 12,
                                    family: 'Manrope'
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: '#6c757d',
                                font: {
                                    size: 12,
                                    family: 'Manrope'
                                },
                                callback: function(value) {
                                    return value + ' –∫–≥';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: goalWeight ? true : false,
                            position: 'top',
                            labels: {
                                color: '#6c757d',
                                font: {
                                    size: 12,
                                    family: 'Manrope'
                                },
                                usePointStyle: true,
                                pointStyle: 'line'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#7a9b8e',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' –∫–≥';
                                }
                            }
                        }
                    }
                }
            });
        }

        /**
         * –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–µ—Å–∞
         */
        function changeWeightPeriod(period) {
            currentWeightPeriod = period;
            loadWeightData(getUserId(), period);
        }

        /**
         * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–µ—Å–∞
         */
        async function addWeight(userId, weight, note = '') {
            try {
                const apiClient = new TelegramBotApiClient();
                const result = await apiClient.addWeightEntry(userId, {
                    weight: parseFloat(weight),
                    note: note
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                let message = '–í–µ—Å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω';
                if (result.data && result.data.targets_recalculated) {
                    message += ' –∏ —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã';
                }
                showToast(message);

                // –û—á–∏—â–∞–µ–º –∫—ç—à
                const cacheKeys = [
                    `profile_${userId}`,
                    `weight_${userId}`,
                    `stats_${userId}`
                ];
                cacheKeys.forEach(key => dataCache.delete(key));

                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                loadWeightData(userId, currentWeightPeriod);

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                const modal = bootstrap.Modal.getInstance(document.getElementById('addWeightModal'));
                if (modal) {
                    modal.hide();
                }

                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('addWeightForm').reset();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ—Å–∞:', error);
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤–µ—Å–∞: ' + error.message, 'error');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º
        async function toggleFavorite(mealId) {
            try {
                const userId = getUserId();
                console.log(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–ª—è –±–ª—é–¥–∞ ${mealId}`);
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
                const favoriteBtn = document.getElementById(`favorite-btn-${mealId}`);
                const isFavorite = favoriteBtn.classList.contains('btn-warning');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch(`https://telegram-bot-api-h136.onrender.com/favorites/${userId}`, {
                    method: isFavorite ? 'DELETE' : 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ meal_id: mealId })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                if (isFavorite) {
                    // –£–±–∏—Ä–∞–µ–º –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                    favoriteBtn.classList.remove('btn-warning');
                    favoriteBtn.classList.add('btn-outline-warning');
                    favoriteBtn.innerHTML = '‚òÜ';
                    favoriteBtn.title = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
                    showToast('–ë–ª—é–¥–æ —É–±—Ä–∞–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'success');
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                    favoriteBtn.classList.remove('btn-outline-warning');
                    favoriteBtn.classList.add('btn-warning');
                    favoriteBtn.innerHTML = '‚≠ê';
                    favoriteBtn.title = '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ';
                    showToast('–ë–ª—é–¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ', 'success');
                }
                
                // –ï—Å–ª–∏ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const recipesSection = document.getElementById('recipes-section');
                if (recipesSection && recipesSection.classList.contains('active')) {
                    loadRecipesData(userId);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º:', error);
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º: ' + error.message, 'error');
            }
        }
        
        async function loadRecipesData(userId) {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
            
            const favoritesListElement = document.getElementById('favorites-list');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            favoritesListElement.innerHTML = `
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é...</p>
                </div>
            `;
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –º–µ–Ω—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const menuData = await apiClient.getMenu(userId);
                console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—é:', menuData);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
                window.favoritesData = menuData.dishes || [];
                window.menuStats = menuData.stats || {};
                window.userTargetCalories = menuData.user_target_calories || 1600;
                window.menuTargetCalories = menuData.menu_target_calories || 1600;
                
                renderMenuDishes(menuData);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ–Ω—é:', error);
                favoritesListElement.innerHTML = `
                    <div class="empty-section">
                        <div class="empty-icon">‚ùå</div>
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é: ${error.message}</p>
                        <button class="btn btn-primary" onclick="loadRecipesData('${userId}')">
                            –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                        </button>
                    </div>
                `;
            }
        }
        
        function renderMenuDishes(menuData) {
            const favoritesListElement = document.getElementById('favorites-list');
            const dishes = menuData.dishes || [];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–∞–ª–æ—Ä–∏—è—Ö
            const recipesTitle = document.querySelector('#recipes-section .page-title');
            if (recipesTitle) {
                recipesTitle.innerHTML = `üåü –ò–∑–±—Ä–∞–Ω–Ω–æ–µ <span class="badge bg-primary ms-2" style="font-size: 0.7rem; vertical-align: middle;">–ú–µ–Ω—é ${menuData.menu_target_calories} –∫–∫–∞–ª</span>`;
            }
            
            if (dishes.length === 0) {
                favoritesListElement.innerHTML = `
                    <div class="empty-section">
                        <div class="empty-icon">üçΩÔ∏è</div>
                        <h5>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–ª—é–¥</h5>
                        <p>–í –º–µ–Ω—é –ø–æ–∫–∞ –Ω–µ—Ç –±–ª—é–¥ –¥–ª—è –≤–∞—à–µ–π —Ü–µ–ª–µ–≤–æ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏</p>
                    </div>
                `;
                return;
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –±–ª—é–¥–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            const categorizedDishes = {};
            dishes.forEach(dish => {
                const category = dish.category || 'other';
                if (!categorizedDishes[category]) {
                    categorizedDishes[category] = [];
                }
                categorizedDishes[category].push(dish);
            });
            
            // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let html = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ–Ω—é
            html += `
                <div class="alert alert-info mb-4" role="alert">
                    <h5 class="alert-heading">–ú–µ–Ω—é ${menuData.menu_target_calories} –∫–∫–∞–ª</h5>
                    <p class="mb-0">–ë–ª—é–¥–∞ –ø–æ–¥–æ–±—Ä–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—à–µ–π —Ü–µ–ª–µ–≤–æ–π –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏: ${menuData.user_target_calories} –∫–∫–∞–ª</p>
                </div>
            `;
            
            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
            const categoryOrder = ['breakfast', 'lunch', 'dinner', 'snack'];
            const categoryNames = {
                'breakfast': 'üåÖ –ó–∞–≤—Ç—Ä–∞–∫–∏',
                'lunch': 'üçΩÔ∏è –û–±–µ–¥—ã',
                'dinner': 'üåô –£–∂–∏–Ω—ã',
                'snack': 'ü•® –ü–µ—Ä–µ–∫—É—Å—ã',
                'other': 'üìã –î—Ä—É–≥–∏–µ –±–ª—é–¥–∞'
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–ª—é–¥–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            categoryOrder.forEach(category => {
                if (categorizedDishes[category] && categorizedDishes[category].length > 0) {
                    html += `
                        <div class="card mb-4">
                            <div class="card-header">
                                ${categoryNames[category] || category}
                            </div>
                            <div class="card-body p-0">
                    `;
                    
                    categorizedDishes[category].forEach(dish => {
                        html += `
                            <div class="favorite-item p-3 border-bottom" 
                                 data-id="${dish.id}" 
                                 data-name="${dish.name.toLowerCase()}" 
                                 data-category="${dish.category}" 
                                 data-calories="${dish.calories}" 
                                 data-protein="${dish.protein}">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="mb-1">${dish.name}</h5>
                                        <p class="meal-description mb-2">${dish.description}</p>
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="badge bg-primary me-2">${dish.calories} –∫–∫–∞–ª</span>
                                            <span class="badge bg-secondary me-2">–ë: ${dish.protein}–≥</span>
                                            <span class="badge bg-secondary me-2">–ñ: ${dish.fat}–≥</span>
                                            <span class="badge bg-secondary">–£: ${dish.carb}–≥</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary" 
                                            onclick="toggleDishDetails(${dish.id})">
                                        <i class="fas fa-info-circle"></i> –†–µ—Ü–µ–ø—Ç
                                    </button>
                                    <button class="btn btn-sm btn-success" 
                                            onclick="addDishToDiary('${dish.id}', '${dish.category}')">
                                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ –¥–Ω–µ–≤–Ω–∏–∫
                                    </button>
                                </div>
                                
                                <div id="dish-details-${dish.id}" class="dish-details mt-3 p-3 bg-light rounded" style="display: none;">
                                    <h6>–†–µ—Ü–µ–ø—Ç –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</h6>
                                    <p>${dish.recipe || '–†–µ—Ü–µ–ø—Ç –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                                    <div class="d-flex justify-content-between">
                                        <span><i class="far fa-clock"></i> ${dish.prep_time || '15-30 –º–∏–Ω'}</span>
                                        <span><i class="fas fa-utensils"></i> ${dish.difficulty || '–õ–µ–≥–∫–æ'}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
            });
            
            favoritesListElement.innerHTML = html;
        }
        function toggleDishDetails(dishId) {
            const detailsElement = document.getElementById(`dish-details-${dishId}`);
            if (detailsElement) {
                detailsElement.style.display = detailsElement.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        async function addDishToDiary(dishId, mealType) {
            try {
                const userId = getUserId();
                console.log(`–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª—é–¥–∞ ${dishId} –≤ –¥–Ω–µ–≤–Ω–∏–∫`);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–ª—é–¥–∞
                let diaryMealType = 'lunch'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±–µ–¥
                
                if (mealType === 'breakfast') {
                    diaryMealType = 'breakfast';
                } else if (mealType === 'dinner') {
                    diaryMealType = 'dinner';
                } else if (mealType === 'snack') {
                    diaryMealType = 'snack';
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await apiClient.addDishToDiary(userId, dishId, diaryMealType);
                
                if (response.status === 'success') {
                    showToast(`–ë–ª—é–¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –¥–Ω–µ–≤–Ω–∏–∫ –∫–∞–∫ ${diaryMealType}`, 'success');
                    
                    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –¥–Ω–µ–≤–Ω–∏–∫–∞
                    dataCache.delete(`diary_${userId}`);
                    dataCache.delete(`daySummary_${userId}_today`);
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞ –≤ –¥–Ω–µ–≤–Ω–∏–∫');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞ –≤ –¥–Ω–µ–≤–Ω–∏–∫:', error);
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞: ' + error.message, 'error');
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        function filterFavorites() {
            const searchTerm = document.getElementById('favorites-search').value.toLowerCase();
            const favoriteItems = document.querySelectorAll('.favorite-item');
            
            favoriteItems.forEach(item => {
                const name = item.dataset.name;
                const description = item.querySelector('.meal-description').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || description.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function filterByCategory(category) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('btn-primary', 'active');
                btn.classList.add('btn-outline-primary');
            });
            
            const activeBtn = document.querySelector(`[data-category="${category}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('btn-outline-primary');
                activeBtn.classList.add('btn-primary', 'active');
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            const favoriteItems = document.querySelectorAll('.favorite-item');
            
            favoriteItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function sortFavorites() {
            const sortValue = document.getElementById('sort-select').value;
            const favoritesList = document.getElementById('favorites-list');
            const favoriteItems = Array.from(document.querySelectorAll('.favorite-item'));
            
            favoriteItems.sort((a, b) => {
                switch (sortValue) {
                    case 'date-desc':
                        return new Date(b.dataset.date || 0) - new Date(a.dataset.date || 0);
                    case 'date-asc':
                        return new Date(a.dataset.date || 0) - new Date(b.dataset.date || 0);
                    case 'calories-asc':
                        return parseInt(a.dataset.calories) - parseInt(b.dataset.calories);
                    case 'calories-desc':
                        return parseInt(b.dataset.calories) - parseInt(a.dataset.calories);
                    case 'protein-desc':
                        return parseInt(b.dataset.protein) - parseInt(a.dataset.protein);
                    case 'name-asc':
                        return a.dataset.name.localeCompare(b.dataset.name);
                    default:
                        return 0;
                }
            });
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const cardBodies = favoritesList.querySelectorAll('.card-body');
            cardBodies.forEach(cardBody => {
                const category = cardBody.previousElementSibling.textContent.trim();
                const categoryItems = favoriteItems.filter(item => {
                    const itemCategory = item.dataset.category;
                    return (category.includes('–ó–∞–≤—Ç—Ä–∞–∫–∏') && itemCategory === 'breakfast') ||
                           (category.includes('–û–±–µ–¥—ã') && itemCategory === 'lunch') ||
                           (category.includes('–£–∂–∏–Ω—ã') && itemCategory === 'dinner') ||
                           (category.includes('–ü–µ—Ä–µ–∫—É—Å—ã') && itemCategory === 'snack');
                });
                
                cardBody.innerHTML = '';
                categoryItems.forEach(item => cardBody.appendChild(item));
            });
        }
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ—Å–∞
        document.addEventListener('DOMContentLoaded', function() {
            const addWeightForm = document.getElementById('addWeightForm');
            if (addWeightForm) {
                addWeightForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                             class="meal-image" 
                             onclick="showImageModal('${favorite.image}')"
                             title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è">
                    `;
                } else {
                    imageHtml = `
                        <div class="meal-image-placeholder">
                            üçΩÔ∏è
                        </div>
                    `;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏
                let categoryIcon = 'üçΩÔ∏è';
                let categoryName = '–ü—Ä–∏–µ–º –ø–∏—â–∏';
                if (favorite.time) {
                    const hour = parseInt(favorite.time.split(':')[0]);
                    if (hour >= 6 && hour < 12) {
                        categoryIcon = 'üåÖ';
                        categoryName = '–ó–∞–≤—Ç—Ä–∞–∫';
                    } else if (hour >= 12 && hour < 17) {
                        categoryIcon = 'üçΩÔ∏è';
                        categoryName = '–û–±–µ–¥';
                    } else if (hour >= 17 && hour < 22) {
                        categoryIcon = 'üåô';
                        categoryName = '–£–∂–∏–Ω';
                    } else {
                        categoryIcon = 'ü•®';
                        categoryName = '–ü–µ—Ä–µ–∫—É—Å';
                    }
                }
                
                favoritesHtml += `
                    <div class="card mb-3 favorite-item" 
                         data-category="${categoryName.toLowerCase()}" 
                         data-name="${favorite.description.toLowerCase()}"
                         data-calories="${favorite.calories}"
                         data-protein="${favorite.protein}"
                         data-date="${favorite.added_date}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="d-flex align-items-start" style="flex: 1;">
                                    ${imageHtml}
                                    <div style="flex: 1;">
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="badge bg-primary me-2">${categoryIcon} ${categoryName}</span>
                                            <small class="text-muted">${favorite.time || '–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</small>
                                        </div>
                                        <div class="meal-description mb-2" style="color: #333; font-weight: 500;">${favorite.description}</div>
                                        <div class="nutrition-info" style="font-size: 0.85rem; color: #666;">
                                            ${favorite.calories} –∫–∫–∞–ª ‚Ä¢ –ë: ${favorite.protein}–≥ ‚Ä¢ –ñ: ${favorite.fat}–≥ ‚Ä¢ –£: ${favorite.carb}–≥
                                        </div>
                                        <small class="text-muted">–î–æ–±–∞–≤–ª–µ–Ω–æ: ${new Date(favorite.added_date).toLocaleDateString('ru-RU')}</small>
                                    </div>
                                </div>
                                <div class="d-flex align-items-start" style="gap: 8px;">
                                    <button class="btn btn-sm btn-warning" 
                                            onclick="removeFavorite(${favorite.meal_id})" 
                                            title="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
                                            style="min-width: 40px;">
                                        ‚≠ê
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="toggleFavoriteDetails(${favorite.meal_id})">
                                        –î–µ—Ç–∞–ª–∏
                                    </button>
                                </div>
                            </div>
                            <div id="favorite-details-${favorite.meal_id}" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #dee2e6;">
                                <h6>–°–æ—Å—Ç–∞–≤:</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>–ü—Ä–æ–¥—É–∫—Ç</th>
                                                <th>–í–µ—Å</th>
                                                <th>–ö–∞–ª–æ—Ä–∏–∏</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${favorite.products ? favorite.products.map(product => `
                                                <tr>
                                                    <td>${product.name}</td>
                                                    <td>${product.weight}–≥</td>
                                                    <td>${product.calories} –∫–∫–∞–ª</td>
                                                </tr>
                                            `).join('') : '<tr><td colspan="3">–°–æ—Å—Ç–∞–≤ –Ω–µ —É–∫–∞–∑–∞–Ω</td></tr>'}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            favoritesListElement.innerHTML = favoritesHtml;
        }
        
        async function removeFavorite(mealId) {
            try {
                const userId = getUserId();
                console.log(`–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –±–ª—é–¥–∞ ${mealId}`);
                
                const response = await fetch(`https://telegram-bot-api-h136.onrender.com/favorites/${userId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ meal_id: mealId })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                showToast('–ë–ª—é–¥–æ —É–±—Ä–∞–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ', 'success');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                loadRecipesData(userId);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ –µ—Å–ª–∏ –æ–Ω–∞ –≤–∏–¥–Ω–∞
                const favoriteBtn = document.getElementById(`favorite-btn-${mealId}`);
                if (favoriteBtn) {
                    favoriteBtn.classList.remove('btn-warning');
                    favoriteBtn.classList.add('btn-outline-warning');
                    favoriteBtn.innerHTML = '‚òÜ';
                    favoriteBtn.title = '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', error);
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ: ' + error.message, 'error');
            }
        }
        
        function toggleFavoriteDetails(mealId) {
            const detailsElement = document.getElementById(`favorite-details-${mealId}`);
            if (detailsElement) {
                detailsElement.style.display = detailsElement.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        function filterFavorites() {
            const searchTerm = document.getElementById('favorites-search').value.toLowerCase();
            const favoriteItems = document.querySelectorAll('.favorite-item');
            
            favoriteItems.forEach(item => {
                const name = item.dataset.name;
                const description = item.querySelector('.meal-description').textContent.toLowerCase();
                
                if (name.includes(searchTerm) || description.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function filterByCategory(category) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('btn-primary', 'active');
                btn.classList.add('btn-outline-primary');
            });
            
            const activeBtn = document.querySelector(`[data-category="${category}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('btn-outline-primary');
                activeBtn.classList.add('btn-primary', 'active');
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            const favoriteItems = document.querySelectorAll('.favorite-item');
            
            favoriteItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function sortFavorites() {
            const sortValue = document.getElementById('sort-select').value;
            const favoritesList = document.getElementById('favorites-list');
            const favoriteItems = Array.from(document.querySelectorAll('.favorite-item'));
            
            favoriteItems.sort((a, b) => {
                switch (sortValue) {
                    case 'date-desc':
                        return new Date(b.dataset.date) - new Date(a.dataset.date);
                    case 'date-asc':
                        return new Date(a.dataset.date) - new Date(b.dataset.date);
                    case 'calories-asc':
                        return parseInt(a.dataset.calories) - parseInt(b.dataset.calories);
                    case 'calories-desc':
                        return parseInt(b.dataset.calories) - parseInt(a.dataset.calories);
                    case 'protein-desc':
                        return parseInt(b.dataset.protein) - parseInt(a.dataset.protein);
                    case 'name-asc':
                        return a.dataset.name.localeCompare(b.dataset.name);
                    default:
                        return 0;
                }
            });
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            favoritesList.innerHTML = '';
            favoriteItems.forEach(item => favoritesList.appendChild(item));
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ—Å–∞–∞
        document.addEventListener('DOMContentLoaded', function() {
            const addWeightForm = document.getElementById('addWeightForm');
            if (addWeightForm) {
                addWeightForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const weight = document.getElementById('weightInput').value;
                    
                    if (weight && weight > 0) {
                        // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
                        const submitBtn = this.querySelector('button[type="submit"]');
                        const originalText = submitBtn.innerHTML;
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
                        
                        addWeight(getUserId(), weight, '').finally(() => {
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = originalText;
                            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                            document.getElementById('weightInput').value = '';
                        });
                    }
                });
            }
        });
    </script>
</body>
</html>


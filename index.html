<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ–∫–µ—Ä –ø–∏—Ç–∞–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #222222;
            --tg-theme-button-color: #4d6073;
            --tg-theme-button-text-color: #ffffff;
        }
        
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            background-color: var(--tg-theme-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #222222);
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow-y: auto;
        }

        .content-container {
            flex-grow: 1;
            padding-bottom: 70px; /* –î–ª—è –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
            overflow-y: auto;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #ffffff;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            color: #6c757d;
            text-decoration: none;
            font-size: 12px;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: var(--tg-theme-button-color, #4d6073);
            font-weight: 600;
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .section {
            display: none;
            padding: 20px;
        }

        .section.active {
            display: block;
        }

        .page-title {
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--tg-theme-text-color, #333);
        }

        .card {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 16px;
            border: none;
        }

        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            border-radius: 12px 12px 0 0 !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—É—Å—Ç—ã—Ö —Å–µ–∫—Ü–∏–π */
        .empty-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            color: #6c757d;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: #dee2e6;
        }
        
        .btn-primary {
            background-color: var(--tg-theme-button-color, #4d6073);
            border-color: var(--tg-theme-button-color, #4d6073);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        
        .btn-outline-primary {
            color: var(--tg-theme-button-color, #4d6073);
            border-color: var(--tg-theme-button-color, #4d6073);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--tg-theme-button-color, #4d6073);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        
        .badge.bg-primary {
            background-color: var(--tg-theme-button-color, #4d6073) !important;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
        }

        .error-message {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        #debug-info {
            padding: 10px;
            background-color: #f8f9fa;
            margin-bottom: 10px;
            font-size: 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div id="debug-info">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    
    <div class="content-container">
        <!-- –°–µ–∫—Ü–∏—è –î–Ω–µ–≤–Ω–∏–∫ -->
        <div id="diary-section" class="section active">
            <h2 class="page-title">üìò –î–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</h2>
            <div id="diary-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞...</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div id="stats-section" class="section">
            <h2 class="page-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div id="stats-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –†–µ—Ü–µ–ø—Ç—ã -->
        <div id="recipes-section" class="section">
            <h2 class="page-title">ü•ó –†–µ—Ü–µ–ø—Ç—ã</h2>
            <div id="recipes-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤...</p>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –í–µ—Å (–ø—É—Å—Ç–∞—è) -->
        <div id="weight-section" class="section">
            <h2 class="page-title">‚öñÔ∏è –í–µ—Å</h2>
            <div class="empty-section">
                <div class="empty-icon">
                    <i class="fas fa-weight"></i>
                </div>
                <h4>–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h4>
                <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–º –≤–µ—Å–µ –∏ –µ–≥–æ –¥–∏–Ω–∞–º–∏–∫–µ.</p>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –ü—Ä–æ—Ñ–∏–ª—å (–æ–±–Ω–æ–≤–ª–µ–Ω–∞) -->
        <div id="profile-section" class="section">
            <h2 class="page-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
            <div id="profile-content">
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <nav class="bottom-nav">
        <div class="container">
            <div class="row text-center">
                <div class="col">
                    <a href="#diary" class="nav-item active" data-section="diary-section">
                        <div class="nav-icon">üìò</div>
                        <span>–î–Ω–µ–≤–Ω–∏–∫</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#stats" class="nav-item" data-section="stats-section">
                        <div class="nav-icon">üìä</div>
                        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#recipes" class="nav-item" data-section="recipes-section">
                        <div class="nav-icon">ü•ó</div>
                        <span>–†–µ—Ü–µ–ø—Ç—ã</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#weight" class="nav-item" data-section="weight-section">
                        <div class="nav-icon">‚öñÔ∏è</div>
                        <span>–í–µ—Å</span>
                    </a>
                </div>
                <div class="col">
                    <a href="#profile" class="nav-item" data-section="profile-section">
                        <div class="nav-icon">üë§</div>
                        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        /**
         * –ö–ª–∏–µ–Ω—Ç API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º Telegram –±–æ—Ç–∞
         */
        class TelegramBotApiClient {
            constructor(apiBaseUrl) {
                this.apiBaseUrl = apiBaseUrl || 'https://telegram-bot-api-h136.onrender.com/api';
                // –ü–æ–ª—É—á–∞–µ–º API –∫–ª—é—á –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                this.apiKey = 'test_api_key';
                
                // –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log('API –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –±–∞–∑–æ–≤—ã–º URL:', this.apiBaseUrl);
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ –ø–∏—Ç–∞–Ω–∏—è
             */
            async getDiary(userId) {
                try {
                    console.log(`–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}`);
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/diary/${userId}`);
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
             */
            async getStats(userId) {
                try {
                    console.log(`–ó–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}`);
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/stats/${userId}`);
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
             * @param {string} userId - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
             * @returns {Promise<Object>} - –î–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤
             */
            async getRecipes(userId) {
                try {
                    console.log(`–ó–∞–ø—Ä–æ—Å —Ä–µ—Ü–µ–ø—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}`);
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/recipes/${userId}`);
                    return response.data;
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}:`, error);
                    throw error;
                }
            }

            /**
             * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
             * @param {Object} mealData - –î–∞–Ω–Ω—ã–µ –æ –ø—Ä–∏–µ–º–µ –ø–∏—â–∏
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
             */
            async addMeal(mealData) {
                try {
                    const response = await this._fetchWithAuth(`${this.apiBaseUrl}/meal`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(mealData)
                    });
                    return response;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏:', error);
                    throw error;
                }
            }

            /**
             * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
             * @param {string} url - URL –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
             * @param {Object} options - –û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞
             * @returns {Promise<Object>} - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
             * @private
             */
            async _fetchWithAuth(url, options = {}) {
                const headers = {
                    'X-API-Key': this.apiKey,
                    ...(options.headers || {})
                };

                // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log(`–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫: ${url}`);
                console.log('–ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:', headers);
                console.log('API –∫–ª—é—á:', this.apiKey);
                console.log('–û–ø—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', options);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –ø–∞–Ω–µ–ª—å
                const debugInfo = document.getElementById('debug-info');
                if (debugInfo) {
                    debugInfo.innerHTML += `<br>–ó–∞–ø—Ä–æ—Å –∫: ${url}`;
                    debugInfo.innerHTML += `<br>API –∫–ª—é—á: ${this.apiKey}`;
                }

                try {
                    const response = await fetch(url, {
                        ...options,
                        headers
                    });

                    // –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç
                    console.log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);
                    console.log('–ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', response.headers);
                    
                    if (debugInfo) {
                        debugInfo.innerHTML += `<br>–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`;
                    }

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`);
                        console.error('–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏:', errorText);
                        
                        if (debugInfo) {
                            debugInfo.innerHTML += `<br>–û—à–∏–±–∫–∞ API: ${response.status} ${response.statusText}`;
                            debugInfo.innerHTML += `<br>–¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: ${errorText}`;
                        }
                        
                        throw new Error(`API –∑–∞–ø—Ä–æ—Å –Ω–µ —É–¥–∞–ª—Å—è: ${response.status} ${response.statusText} - ${errorText}`);
                    }

                    const data = await response.json();
                    console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
                    return data;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', error);
                    
                    if (debugInfo) {
                        debugInfo.innerHTML += `<br>–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`;
                    }
                    
                    throw error;
                }
            }
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            updateDebugInfo();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API –∫–ª–∏–µ–Ω—Ç–∞
            const apiClient = new TelegramBotApiClient();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            initTelegramWebApp();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
            loadAllData();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.section');

            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    navItems.forEach(navItem => navItem.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                    this.classList.add('active');
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
                    sections.forEach(section => section.classList.remove('active'));
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–≤–µ—Ä—Ö
                    window.scrollTo(0, 0);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏"
            document.addEventListener('click', function(e) {
                if (e.target.closest('#addMealBtn')) {
                    sendDataToBot({
                        action: 'add_meal',
                        timestamp: new Date().toISOString()
                    });
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" –≤ —Ä–µ—Ü–µ–ø—Ç–∞—Ö
            document.addEventListener('click', function(e) {
                if (e.target.closest('.recipe-details-btn')) {
                    const recipeCard = e.target.closest('.card');
                    const recipeTitle = recipeCard.querySelector('.card-title').textContent;
                    
                    sendDataToBot({
                        action: 'get_recipe_details',
                        recipe: recipeTitle
                    });
                }
            });
        });

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
         */
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            debugInfo.innerHTML = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const urlParams = new URLSearchParams(window.location.search);
            const userIdFromUrl = urlParams.get('userId');
            if (userIdFromUrl) {
                debugInfo.innerHTML += `<br>userId –∏–∑ URL: ${userIdFromUrl}`;
            } else {
                debugInfo.innerHTML += '<br>userId –≤ URL –Ω–µ –Ω–∞–π–¥–µ–Ω';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                debugInfo.innerHTML += '<br>Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω';
                if (window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                    const user = window.Telegram.WebApp.initDataUnsafe.user;
                    debugInfo.innerHTML += `<br>Telegram user: ${user.id} (${user.first_name})`;
                } else {
                    debugInfo.innerHTML += '<br>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                }
            } else {
                debugInfo.innerHTML += '<br>Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const savedUser = localStorage.getItem('telegramUser');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    debugInfo.innerHTML += `<br>localStorage user: ${userData.id}`;
                } catch (e) {
                    debugInfo.innerHTML += '<br>–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ localStorage';
                }
            } else {
                debugInfo.innerHTML += '<br>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
            }
            
            // –ò—Ç–æ–≥–æ–≤—ã–π userId
            const userId = getUserId();
            debugInfo.innerHTML += `<br>–ò—Ç–æ–≥–æ–≤—ã–π userId: ${userId || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}`;
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
         */
        async function loadAllData() {
            const userId = getUserId();
            
            if (!userId) {
                const errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.';
                showError('diary-content', errorMessage);
                showError('stats-content', errorMessage);
                showError('recipes-content', errorMessage);
                showError('profile-content', errorMessage);
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
            await Promise.all([
                loadDiaryData(userId),
                loadStatsData(userId),
                loadRecipesData(userId),
                loadProfileData(userId)
            ]);
        }

        /**
         * –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram WebApp
         */
        function getUserId() {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) {
                console.log('–ü–æ–ª—É—á–µ–Ω userId –∏–∑ Telegram WebApp:', window.Telegram.WebApp.initDataUnsafe.user.id);
                return window.Telegram.WebApp.initDataUnsafe.user.id.toString();
            }
            
            // –ó–∞—Ç–µ–º –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            const urlParams = new URLSearchParams(window.location.search);
            const userIdFromUrl = urlParams.get('userId');
            if (userIdFromUrl) {
                console.log('–ü–æ–ª—É—á–µ–Ω userId –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:', userIdFromUrl);
                return userIdFromUrl;
            }
            
            // –ó–∞—Ç–µ–º –ø—Ä–æ–±—É–µ–º –∏–∑ localStorage
            const savedUser = localStorage.getItem('telegramUser');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    if (userData && userData.id) {
                        console.log('–ü–æ–ª—É—á–µ–Ω userId –∏–∑ localStorage:', userData.id);
                        return userData.id.toString();
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage:', e);
                }
            }
            
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å userId. WebApp –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∏–∑ Telegram.');
            return null;
        }

        /**
         * –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp
         */
        function initTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                
                // –†–∞—Å—à–∏—Ä—è–µ–º WebApp –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                tg.expand();
                
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    console.log('Telegram user:', user);
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
                    localStorage.setItem('telegramUser', JSON.stringify(user));
                    
                    // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤—ã–≤–æ–¥–∏–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    console.log('User ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', user.id);
                } else {
                    console.error('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –≤ Telegram WebApp');
                }
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã –∏–∑ Telegram
                document.documentElement.style.setProperty('--tg-theme-bg-color', tg.backgroundColor || '#ffffff');
                document.documentElement.style.setProperty('--tg-theme-text-color', tg.textColor || '#222222');
                document.documentElement.style.setProperty('--tg-theme-button-color', tg.buttonColor || '#4d6073');
                document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.buttonTextColor || '#ffffff');
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                tg.BackButton.onClick(() => {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ–∫—Ü–∏—é
                    const activeSection = document.querySelector('.section.active');
                    const activeSectionId = activeSection.id;
                    
                    // –ï—Å–ª–∏ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–¥–Ω–µ–≤–Ω–∏–∫), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω–µ–π
                    if (activeSectionId !== 'diary-section') {
                        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
                        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–Ω–µ–≤–Ω–∏–∫
                        document.getElementById('diary-section').classList.add('active');
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        document.querySelector('[data-section="diary-section"]').classList.add('active');
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                        tg.BackButton.hide();
                    }
                });
            } else {
                console.error('Telegram WebApp API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                // –ï—Å–ª–∏ API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                document.body.insertAdjacentHTML('afterbegin', 
                    '<div class="alert alert-warning m-2" role="alert">' +
                    '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ Telegram. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.' +
                    '</div>'
                );
            }
        }

        /**
         * –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
         */
        async function loadDiaryData(userId) {
            const diaryContent = document.getElementById('diary-content');
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                const apiClient = new TelegramBotApiClient();
                const diaryData = await apiClient.getDiary(userId);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–Ω–µ–≤–Ω–∏–∫–∞
                renderDiaryData(diaryData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞:', error);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                if (error.message && error.message.includes('403')) {
                    showError('diary-content', '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.');
                } else {
                    showError('diary-content', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–Ω–µ–≤–Ω–∏–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                }
            }
        }

        /**
         * –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
         */
        async function loadStatsData(userId) {
            const statsContent = document.getElementById('stats-content');
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                const apiClient = new TelegramBotApiClient();
                const statsData = await apiClient.getStats(userId);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                renderStatsData(statsData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                if (error.message && error.message.includes('403')) {
                    showError('stats-content', '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.');
                } else {
                    showError('stats-content', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                }
            }
        }

        /**
         * –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
         */
        async function loadRecipesData(userId) {
            const recipesContent = document.getElementById('recipes-content');
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                const apiClient = new TelegramBotApiClient();
                const recipesData = await apiClient.getRecipes(userId);
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤
                renderRecipesData(recipesData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤:', error);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                if (error.message && error.message.includes('403')) {
                    showError('recipes-content', '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.');
                } else {
                    showError('recipes-content', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω–∏–∫–∞
        function renderDiaryData(data) {
            const diaryContent = document.getElementById('diary-content');
            
            let html = '<div class="container">';
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–Ω–∏
            data.days.forEach(day => {
                html += `
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>${day.date}</span>
                        <span class="badge bg-primary">${day.total_calories} –∫–∫–∞–ª</span>
                    </div>
                    <div class="card-body">
                `;
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–∏–µ–º—ã –ø–∏—â–∏
                day.meals.forEach((meal, index) => {
                    const isLast = index === day.meals.length - 1;
                    
                    html += `
                    <div class="meal-item ${isLast ? '' : 'mb-3 pb-3 border-bottom'}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h5 class="mb-1">${meal.name}</h5>
                                <p class="text-muted small mb-0">${meal.time}</p>
                            </div>
                            <span class="badge bg-light text-dark">${meal.calories} –∫–∫–∞–ª</span>
                        </div>
                        <div class="mt-2">
                    `;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã
                    meal.items.forEach(item => {
                        html += `
                        <div class="d-flex justify-content-between align-items-center small">
                            <span>${item.name}</span>
                            <span class="text-muted">${item.calories} –∫–∫–∞–ª</span>
                        </div>
                        `;
                    });
                    
                    html += `
                        </div>
                    </div>
                    `;
                });
                
                html += `
                    </div>
                </div>
                `;
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏
            html += `
            <div class="d-grid gap-2 mb-4">
                <button id="addMealBtn" class="btn btn-primary">
                    <i class="fas fa-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏
                </button>
            </div>
            `;
            
            html += '</div>';
            
            diaryContent.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function renderStatsData(data) {
            const statsContent = document.getElementById('stats-content');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
            if (!data || !data.general) {
                statsContent.innerHTML = `
                <div class="empty-section">
                    <div class="empty-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h4>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</h4>
                    <p>–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –≤ –¥–Ω–µ–≤–Ω–∏–∫, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.</p>
                </div>
                `;
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const general = data.general;
            const nutrition = data.nutrition_distribution;
            const topProducts = data.top_products;
            
            let html = `
            <div class="card mb-4">
                <div class="card-header">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                <div class="card-body">
                    <div class="row mb-2">
                        <div class="col-7">–°—Ä–µ–¥–Ω—è—è –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å:</div>
                        <div class="col-5 text-end">${general.avg_calories} –∫–∫–∞–ª</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-7">–î–Ω–µ–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:</div>
                        <div class="col-5 text-end">${general.days_tracked}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-7">–°–æ–±–ª—é–¥–µ–Ω–∏–µ –Ω–æ—Ä–º—ã:</div>
                        <div class="col-5 text-end">
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" role="progressbar" style="width: ${general.adherence_percent}%;" 
                                    aria-valuenow="${general.adherence_percent}" aria-valuemin="0" aria-valuemax="100">
                                    ${general.adherence_percent}%
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-7">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Å–∞:</div>
                        <div class="col-5 text-end">
                            ${general.weight_change > 0 ? '+' : ''}${general.weight_change} –∫–≥
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ë–ñ–£</div>
                <div class="card-body">
                    <div class="progress mb-3" style="height: 25px;">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: ${nutrition.protein}%;" 
                            aria-valuenow="${nutrition.protein}" aria-valuemin="0" aria-valuemax="100">
                            –ë–µ–ª–∫–∏ ${nutrition.protein}%
                        </div>
                        <div class="progress-bar bg-warning" role="progressbar" style="width: ${nutrition.fat}%;" 
                            aria-valuenow="${nutrition.fat}" aria-valuemin="0" aria-valuemax="100">
                            –ñ–∏—Ä—ã ${nutrition.fat}%
                        </div>
                        <div class="progress-bar bg-success" role="progressbar" style="width: ${nutrition.carb}%;" 
                            aria-valuenow="${nutrition.carb}" aria-valuemin="0" aria-valuemax="100">
                            –£–≥–ª–µ–≤–æ–¥—ã ${nutrition.carb}%
                        </div>
                    </div>
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="small text-muted">–ë–µ–ª–∫–∏</div>
                            <div class="fw-bold">${nutrition.protein}%</div>
                        </div>
                        <div class="col-4">
                            <div class="small text-muted">–ñ–∏—Ä—ã</div>
                            <div class="fw-bold">${nutrition.fat}%</div>
                        </div>
                        <div class="col-4">
                            <div class="small text-muted">–£–≥–ª–µ–≤–æ–¥—ã</div>
                            <div class="fw-bold">${nutrition.carb}%</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card mb-4">
                <div class="card-header">–¢–æ–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
            `;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤
            topProducts.forEach(product => {
                html += `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    ${product.name}
                    <span class="badge bg-primary rounded-pill">${product.count}</span>
                </li>
                `;
            });
            
            html += `
                    </ul>
                </div>
            </div>
            `;
            
            statsContent.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤
        function renderRecipesData(data) {
            const recipesContent = document.getElementById('recipes-content');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö
            if (!data || !data.recipes || data.recipes.length === 0) {
                recipesContent.innerHTML = `
                <div class="empty-section">
                    <div class="empty-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h4>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤</h4>
                    <p>–†–µ—Ü–µ–ø—Ç—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è.</p>
                </div>
                `;
                return;
            }
            
            let html = `
            <div class="mb-3">
                <div class="input-group">
                    <input type="text" class="form-control" id="recipeSearch" placeholder="–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤...">
                    <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="mb-3 d-flex flex-wrap gap-2" id="categoryFilters">
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            data.categories.forEach(category => {
                html += `
                <button class="btn btn-sm ${category === '–í—Å–µ' ? 'btn-primary' : 'btn-outline-primary'} category-filter" 
                    data-category="${category}">
                    ${category}
                </button>
                `;
            });
            
            html += `
            </div>
            
            <div id="recipesList">
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ—Ü–µ–ø—Ç—ã
            data.recipes.forEach(recipe => {
                html += `
                <div class="card mb-3 recipe-card" data-category="${recipe.category}">
                    <div class="card-body">
                        <h5 class="card-title">${recipe.title}</h5>
                        <div class="d-flex mb-2">
                            <span class="badge bg-light text-dark me-2">${recipe.category}</span>
                            <span class="badge bg-light text-dark me-2">${recipe.prep_time}</span>
                            <span class="badge bg-primary">${recipe.calories} –∫–∫–∞–ª</span>
                        </div>
                        <p class="card-text small">${recipe.description}</p>
                        <button class="btn btn-sm btn-outline-primary recipe-details-btn">
                            <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                    </div>
                </div>
                `;
            });
            
            html += `
            </div>
            `;
            
            recipesContent.innerHTML = html;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞
            document.querySelectorAll('.category-filter').forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    document.querySelectorAll('.category-filter').forEach(btn => {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn-outline-primary');
                    });
                    this.classList.remove('btn-outline-primary');
                    this.classList.add('btn-primary');
                    
                    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–µ—Ü–µ–ø—Ç—ã
                    document.querySelectorAll('.recipe-card').forEach(card => {
                        if (category === '–í—Å–µ' || card.getAttribute('data-category') === category) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞
            document.getElementById('recipeSearch').addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                
                document.querySelectorAll('.recipe-card').forEach(card => {
                    const title = card.querySelector('.card-title').textContent.toLowerCase();
                    const description = card.querySelector('.card-text').textContent.toLowerCase();
                    
                    if (title.includes(searchText) || description.includes(searchText)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
            document.getElementById('clearSearch').addEventListener('click', function() {
                document.getElementById('recipeSearch').value = '';
                document.querySelectorAll('.recipe-card').forEach(card => {
                    card.style.display = 'block';
                });
            });
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
         */
        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `
                <div class="error-message">
                    <p><i class="fas fa-exclamation-circle"></i> ${message}</p>
                </div>
                `;
            }
        }

        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç–∞
         */
        function sendDataToBot(data) {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify(data));
            } else {
                alert('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ Telegram');
            }
        }
    </script>
    <script src="profile.js"></script>
</body>
</html>
